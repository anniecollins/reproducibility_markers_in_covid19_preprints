bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Flexible

Fitting

of

Biomolecular

Structures

to

Atomic

Force

Microscopy Images via Biased Molecular Simulations

Toru Niina , Sotaro Fuchigami , and Shoji Takada
Department of Biophysics, Graduate School of Science, Kyoto University, Kyoto 606-8502,
Japan
1

1

1

1.

Keywords; coarse-grained molecular dynamics, HS-AFM, afmize, CafeMol

Abstract
Atomic force microscopy (AFM) is a prominent imaging technology that observes large-scale
structural dynamics of biomolecules near the physiological condition, but the AFM data are
limited to the surface shape of specimens. Rigid-body fitting methods were developed to obtain
molecular structures that fit to an AFM image, without accounting for conformational changes.
Here we developed a method to fit flexibly a three-dimensional biomolecular structure into an
AFM image. First, we describe a method to produce a pseudo-AFM image from a given
three-dimensional structure in a differentiable form. Then, using a correlation function
between the experimental AFM image and the computational pseudo-AFM image, we
developed a flexible fitting molecular dynamics (MD) simulation method, by which we obtain
protein structures that well fit to the given AFM image. We first test it with a twin-experiment;
for a synthetic AFM image produced from a protein structure different from its native
conformation, the flexible fitting MD simulations sampled those that fit well the AFM image.
Then, parameter dependence in the protocol is discussed. Finally, we applied the method to a
real experimental AFM image for a flagellar protein FlhA, demonstrating its applicability. We
also test the rigid-body fitting of a fixed structure to the AFM image. Our method will be a
general tool for structure modeling based on AFM images and is publicly available through
CafeMol software.
INTRODUCTION
Elaborate mechanisms of cells are realized by functional biomolecules that often undergo
conformational changes to show their functionalities. Resolving their conformations at work is
an essential step to understand the underlying physical machinery of life. However, it is still
difficult to observe the process of conformational changes of working biomolecules directly in
near atomic resolution. While X-ray crystallography is a powerful method that has the ability to
determine the atomic coordinates , it requires crystallization of the protein stabilizing specific
conformational states. Recent revolution in cryo-electron microscopy (cryo-EM) enables to
obtain structures at atomic resolution without crystallization . However, in order to gain high
1

2,3

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

resolution, cryo-EM requires freezing into ultra-low temperature and averaging images for
individual conformations. Thus, while at high-spatial resolution, X-ray crystallography and
cryo-EM provide snapshots of biomolecules at somewhat non-physiological condition.
The atomic force microscopy (AFM) is a prominent microscopic method that is used
extensively to acquire high-resolution images directly under near physiological conditions in
the field of molecular biology . Unlike other microscopes, it scans the specimen with a physical
probe that monitors the force from the surface of molecules. Owing to the efforts to increase the
frame acquisition rate, nowadays a high-speed AFM (HS-AFM) takes tens of frames per second .
Typically, HS-AFM achieves ~2 nm lateral resolution and ~0.15 nm vertical resolution .
Importantly, the measurement process is gentle enough to preserve the structures and
functions of biomolecules. It is said that every tapping by the vibrating cantilever tip gives 2 to
5 k T on average to its specimen . Additionally, the energy provided by tapping dissipates
immediately into several degrees of freedom of the system including water molecules. Thanks
to its spatiotemporal resolution, HS-AFM is employed to capture the dynamics of working
biomolecules, such as F ATPase , Myosin V , bacteriorhodopsin , CRISPR-Cas9 , and many
others and provided us new insights about their structures at work. Low-invasive observation
of HS-AFM enables to capture the dynamics of working biomolecules at the single molecule
resolution.
Although the HS-AFM is widely used to investigate the dynamics of functional
biomolecules, there is no tool to reconstruct the structure from AFM image through flexible
fitting method. The resolution of AFM images is not high enough to construct an atomic
structure model from scratch. Therefore, high-resolution structures of the molecules obtained
by other experimental observations are useful as the starting point to reconstruct
three-dimensional molecular models. Generally, the analysis begins with detection of image
areas in which the molecules of interest are located; there are several methods that are utilized
for that purpose, such as binary digitization and volumetric analysis . As a next step, for
large molecules and macromolecular complexes, there are methods to perform rigid-body fitting
to determine the position and orientation of each protein or its domains that is optimal by
certain criteria . Those methods were applied not only to macromolecular complex
structures , but also to the arrangement of domains of a large protein and successfully
determined the relative orientation. Though the methods have an ability to determine the most
likely arrangements of proteins and domains, the rigid body fitting methods have a limitation
when investigating conformational changes of molecules because these methods treat
structures of the proteins/domains fixed in their known structures.
In this work, we developed a new method to obtain structural information from AFM
images by integrating a cost function that represents similarity between structural models and
AFM images with molecular dynamics (MD) simulations. To quantitatively compare the
4‚Äì7

7

7

5

B

1

8

9

10

12

11

13

14‚Äì16

17,18

19,20

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

structural models and AFM images, we first convert a three-dimensional structural model into
a pseudo-AFM image. Since the previous algorithm to generate pseudo-AFM image from
structural models is not applicable to MD simulations due to non-differentiability, we first
developed an algorithm to generate a pseudo-AFM image from a structure model in a
differentiable form, which serves as a cost function. Next, we applied the cost function to the
rigid-body Monte-Carlo simulation and confirmed that our method successfully found the
appropriate orientation from noisy AFM images by minimizing the cost. After that, using our
new cost function, we constructed a new force field that enables flexible fitting into AFM images.
We combined our biasing potential, i.e., the cost function, with a well-established
coarse-grained protein model, AICG2+ , and applied it to several test proteins with varying
structural characteristics. In a twin-experiment, by comparing the resulting conformations and
the reference structure that is used to generate target AFM image, we confirmed that our new
flexible fitting method successfully samples near-optimal structures. Lastly, we demonstrated
that our method works with real experimental data. Starting from the crystal structure placed
by hand, our method successfully increases the similarity between the experimental AFM
image and the structural model, giving plausible three-dimensional structures that are
compatible with the experiment.
21‚Äì23

Methods
Collision-detection pseudo-AFM Image Generation: We begin with a conventionally used
method to generate a pseudo-AFM image for a given protein structure model (Figure 1A). This
method will be used to quantify the fitness of a structural model with the experimental AFM
image; we will use a correlation between the experimental AFM image with the pseudo-AFM
image generated from the structure model. Previously, a method has been used to compare
experimentally obtained AFM images with pseudo-AFM images generated from known PDB
structures . This conventional method generates the height information corresponding to each
pixel by calculating a steric collision between the tip of a cantilever and atoms in the molecular
models by moving tip position down (Figure 1B). As the tip of cantilever, we assume a shape
composed of a cone capped by a sphere and choose r=1.0 nm for the tip radius and Œ∏ = 5 degree
for the half apex angle. Then, we can calculate the height for a given molecular structure. In
this work, we took this approach, termed the collision-detection method, to generate a reference
pseudo-AFM image. The collision-detection method is available as a tool "afmize" at
http://doi.org/10.5281/zenode.3362044.
8

Smoothed Pseudo-AFM Image Function: Since the above procedure cannot be described as a
smooth and differentiable function, the procedure is not directly applicable as a potential

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

energy function in flexible-fitting MD simulation. Hence, we propose a new method to generate
pseudo-AFM images in a differentiable form, approximating the above method by a set of
smooth weighting functions.
For a target biomolecule represented by its coordinate  ,  ,   and radius  for the
j -th particle (j = 1,,,, N), we define a height function  at the p-th pixel  ,   as






log 1  ‚àë exp 

‡≥ï ‡≥õ

‡∞Æ



‡∞Æ

‡≥ï ‡≥õ

 exp 

‡∞Æ

‡≥ï ‡≥ï


.



(1)

Here, without loss of generality, we define xy-plane as the stage of the AFM so that the
z-coordinate represents the height of the specimen. In this function, we used two weighting
functions to each particle. One is a Gaussian function which measures the closeness between
the p-th pixel center and the j-th particle in xy plane and takes a value close to 1 when a particle
locates near the center position of the p -th pixel. The parameter  represents the spatial range.
The other weighting function is the so-called logarithm-summation-exponential function of the
position along the z coordinate of each particle, which is a differentiable approximation to the
maximum function. is a parameter that makes the function smooth; the larger is, the
smoother the surface  is. The constant 1 in the logarithm function represents the stage
height at the absence of the specimen.
In this work, the is set to 0.1 nm, which is the smallest value where the numerical
calculation is still stable with our target proteins in this paper. With even a smaller , the
numerical errors become intolerable and make the whole process unstable. The  s are
determined by comparing the image generated by the proposed method and the traditional
method. We chose the value that makes the highest correlation between the images generated
by traditional method and our smoothed method (see "Results").

Stage Potential: To observe biomolecules by AFM, target molecules are placed on the AFM stage
. We set the planar AFM stage as the plane z 0. We modeled the interaction
between the AFM stage and biomolecules as a simple Lennard-Jones potential along z axis,
[citation-needed]





 4! "


#




$



#
%" $ 


where # is the radius of i-th particle. We choose ! 1.2 kcal/mol that is weak enough to allow
them to diffuse and rotate on the surface without breaking its structure.

Biasing Potential: To achieve the maximum similarity between a pseudo-AFM image generated
from a structure model and the experimental AFM data, we introduce a biasing potential (a cost
function) that is a differentiable function of coordinates and thus that can be used in MD
simulations. For the functional form, we employed a modified correlation coefficient &. &. ( to

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

define the form of the potential, motivated by , defined as
18

 

)‚àë

&. &. (
)‚àë




 



  




 )‚àë

The biasing potential is defined by


!

(







(






(

,

*+," - 1 % &. &. (

where ," is the Boltzmann constant, - is the temperature, * is a dimensionless parameter
that controls the strength of the bias. The appropriate value of * will be discussed later.

Protein Modeling: We used two proteins, a fragment of tight-junction protein ZO-1 (PDB ID:
3SHW) and the cytoplasmic domain of a flagellar protein FlhA (3A5I) as target molecules in
our test cases. Missing residues and atoms in the middle of PDB structures were modeled by
Modeller . We simulated all the target proteins using the AICG2+ model where each amino
acid is represented by a coarse-grained bead located at the position of corresponding CŒ± atom.
Because ZO-1 and PDZ12 have some flexible linker region, we removed native contacts between
linker and globular domains and native contacts between globular domains.
We also used dynein and hemoglobin in our rigid-body Monte-Carlo simulations.
For them, we used all the heavy atoms in the PDB structure. Since these are modeled as a rigid
body, we just keep their structure during the whole simulation processes.
26,27

28

29

30

Rigid Body Metropolis Monte-Carlo Simulation: For comparison, we performed Metropolis
Monte-Carlo simulated annealing for the rigid-body fitting to the AFM image. Method details
are presented in the Supporting Information.
Flexible Fitting Molecular Dynamics Simulations: In the flexible fitting MD simulations, the
total energy function,  , is given as a sum of the protein force-field,  , the stage
potential,  , and the biasing potentials towards the AFM image,  ! ;

     ! .
The simulations were conducted by Langevin dynamics at a constant temperature of 300K for
10 MD steps. All the simulations are conducted by an in-house program named Mjolnir that is
freely available on GitHub; https://github.com/Mjolnir-MD/Mjolnir. The tool is implemented in
CafeMol as well, which is also available through its website (www.cafemol.org).
8

31

RESULTS
Figure 1. (A) The structure of a test protein, dynein (upper) and an example of its synthetic

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

AFM image constructed by the collision-detection method with a noise (lower). (B) A cartoon for
the collision-detection method in "afmize" to generate the pseudo-AFM image by detecting the
collision between the cantilever tip and a molecular model. r and Œ∏ represent the tip radius and
the half of apex angle, respectively. (C) A cartoon for the method to generate a smoothed AFM
image. (D) Pseudo-AFM images of dynein generated by the collision-detection method with
varying parameters r and Œ∏. As the parameters increase, the images become more blurred. (E)
The correlation between the collision-detection and the smoothed pseudo-AFM images. The
radius and angle used are indicated by the color and line type of every curves, respectively. By
changing the value of œÉ, the smoothed image-generation method can achieve sufficiently high
correlation with the one generated by the collision-detection method.

Verification of Smoothed AFM-image generation method.
We first verified that a smoothed pseudo-AFM image generated by out new approach is close
enough to a pseudo-AFM image obtained by the collision-detection method. As the target
protein, we chose the structure of dynein (Figure 1A) because it is large and has several
structural elements and thus can be a good test structure. First, we generated pseudo-AFM
images using the collision-detection method with several tip sizes and apex angles as reference
images (Figure 1D). Then, we generated the smoothed pseudo-AFM images with varying œÉ
values. The similarity between these two AFM images were quantified as &. &. (, the same
metric we use for the flexible fitting MD later. Figure 1E shows correlations between results
obtained by two methods. For any combination of two parameters r and Œ∏ tested, we can
achieve the correlation value over 0.98 by choosing the appropriate œÉ value (Table 1). It means
that by using our smoothed pseudo-AFM image generation algorithm, we can generate almost
the same pseudo-AFM image having high correlation with an image obtained by conventional
collision-detection method.
Figure 2. Summary of the rigid-body fitting test of a synthetic AFM image of dynein (A-D) and
hemoglobin (E). (A) The outline of the twin experiment protocol. (B) The trajectories of
correlation coefficient (left) and RMSD (right) for 10 independent simulated annealing runs.
The trajectory that finds the most correlated snapshot is colored red. (C) Pseudo-AFM images
on which varying Gaussian noise applied. (D) The number of trajectories that successfully
found the correct orientation out of 100 independent simulations with different noise levels. We
considered the trajectories found the correct orientation if the final snapshot has RMSD value
smaller than 0.5 nm. (E) Histogram of the number of structures in clusters (left), representative

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

structures in two major clusters (red: cluster 1, orange: cluster 2) (middle), and
two-dimensional heat map of correlation coefficient and RMSD (right).

Rigid Body Metropolis Monte-Carlo Simulation.
Before starting flexible fitting MD simulation, using % &. &. ( as the cost function, we
performed the rigid body Metropolis Monte-Carlo simulations with the simulated annealing as
a simpler case to confirm whether our cost function works successfully.
First, we used dynein consisted of multiple structural units as our test protein
because it is large enough so that most of the structural units can be distinguished in the AFM
image and it has an asymmetric structure that can be considered to be easy to find the correct
orientation. We first generated a pseudo-AFM image by the collision-detection method of
randomly rotated protein structure and added Gaussian noise to the image. Then, we used this
pseudo-AFM image as the reference (synthetic) AFM image in order to evaluate the correctness
of results. Starting from a randomly-oriented initial structure, we performed rigid body
Metropolis Monte-Carlo simulation (Figure 2A) to maximize &. &. (. To compare the reference
structure and the snapshot during the simulation, we used the root mean square displacement
(RMSD) without aligning them (Since we used the rigid body model, if we align it, the RMSD
value becomes zero). In most of the Monte Carlo runs, as the number of steps increases with the
temperature decreasing, correlation coefficient increases and the RMSD value decreases
(Figure 2B). Thus, our rigid-body approach can find the location and orientation close to the
ground truth image (RMSD = 0.0298 nm) by optimizing the correlation between pseudo-AFM
image based on the snapshot and the reference AFM image.
Second, to evaluate the robustness of our approach against the noise level, we added
spatially-independent Gaussian noise of different levels to our reference pseudo-AFM images
(Figure 2C). Then we repeated the same Monte Carlo simulation as above and counted how
many simulations find the protein configurations within 0.5 nm of RMSD from the reference
structure (Figure 2D). As expected, the success rate decreases as the noise level increases. It
becomes difficult to find the correct configuration if the variance of Gaussian noise becomes
larger than 3.0 nm in this case.
Next, we performed the same twin experiment for hemoglobin that has a symmetric
structure. The hemoglobin is a hetero-tetramer (Œ±Œ≤) with Œ± and Œ≤ subunits being homologous
and thus possesses the two-fold symmetry and four-fold pseudo-symmetry. We found that most
of trajectories fell into one of the two configurations, due to its underlying symmetry. By the
k-means clustering on the ensemble of final configurations, we obtained two major and one
minor clusters. One corresponds to the same orientation as the reference and the second one
corresponds to the symmetry-related and thus equivalent configuration (Figure 2E). The minor
third cluster corresponds to the wrong placement caused by local minima in the biasing
2

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

potential. This third cluster exemplifies potential mis-fitting of the structure when the target
molecule contains more than two mutually similar parts.

Figure 3. A twin-experiment for the flexible fitting MD simulation to the AFM image for a
fragment of tight junction protein, ZO-1. (A) The snapshots in the representative trajectory are
drawn in red particles. The ground truth configuration used to generate the synthetic AFM
image is shown in green. The first (left) snapshot; the initial configuration. The second; 100-th
step snapshot. The last(right) snapshot; the most correlated configuration. (B) The time course
of the value of RMSD from the ground truth (red) and the correlation coefficient (yellow). The
points that correspond to the shown snapshots are shown in cross markers. (C) The
corresponding synthetic AFM images generated from the snapshots shown in A and the
reference image.
Flexible Fitting to the AFM Image using Molecular Dynamics Simulation.
Next, we examine whether our biasing potential finds appropriate protein configuration that is
far from initial structure, with a twin experiment. To test the capability of our biasing potential
in flexible fitting, we used a fragment of tight junction protein, ZO-1 that contains two globular
domains that are connected by a flexible linker. First, we performed a short MD simulation to
obtain an open configuration of the ZO-1 protein starting from the crystal structure. Next,
using the last snapshot of the simulation, we generated a synthetic AFM image using the
collision-detection AFM image generation method (Figure 3C the right most image). Using the
synthetic AFM image, we performed 40 independent constant temperature MD simulations for
flexible fitting.
The representative trajectory shows that our method successfully increases the
correlation and decreases RMSD from the ground truth (Figure 3B). Unlike the case of rigid
body MC simulations, here we calculated RMSD values after structure alignment. Some of the
snapshots during the simulation are shown in Figure 3A and the corresponding AFM images in
Figure 3C. It can be seen that the protein approaches toward the reference structure through
conformational changes. It means that by optimizing the structure according to our novel
biasing potential, the corresponding protein structure can be found.
Figure 4. Sampling and test for the Œ∫ values for the flexible fitting MD simulation to the AFM
image for a fragment of tight junction protein, ZO-1. The Œ∫ values, 0.1 (A), 1.0 (B), 10.0 (C), and
100.0 (D) are tested. For the most correlated snapshot, the correlation coefficient and the RMSD
from the ground truth were 0.915 and 0.763 nm, respectively, in A and 0.986 and 0.569 nm,

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

respectively, in B.

Sampling Efficiency and the Appropriate Values of Parameters.
The biasing potential has a parameter * that modulates the overall strength of the bias. We
expect that a too large value of * leads to unacceptable conformational deformation of proteins
and overfitting. Instead, a too small value of * makes the convergence slower and increases the
required simulation time. To find the optimal value of * , we performed large-scale
conformational sampling with various * values; 40 independent constant temperature MD
simulations of 10 MD steps at 300K for each * value.
In the case of * 0.1 , the smallest value tested (Figure 4A), the peak in the
population appears at a region with the correlation ~0.6 and the RMSD value ~2.0 nm, which
are largely deviated from the ground-truth structure. We, however, note that the sample
reaches at the correlation coefficient of 0.915, where the RMSD was 0.763 nm. With this
parameter, one needs to sample very long to obtain a reasonably fit structure as a rare sample.
Next, Figure 4B shows the result for * 1, in which the biasing potential strength is
comparable to the kinetic energy. The population peak appears around the region where
correlation is high (~0.95) and RMSD value is small (~0.7 nm). Importantly, in this case, there
is a tendency that the highest correlation corresponds to smaller RMSD values to the ground
truth. Using the sample with the highest correlation (0.986), we obtain the structure with its
RMSD = 0.569 nm, which is better than the case of * 0.1. Contrary, in the cases of larger *
values (Figure 4C for * 10, and D for * 100), there appear many distinct high-correlation
structures which includes not only small RMSD snapshots, but also large RMSD structures.
Thus, as expected, a strong biasing potential leads structures to deformed states. It seems that
the total biasing energy should be comparable to the total kinetic energy, i.e. the value of *
should be in the order of 1.
8

Figure 5. The application of the flexible fitting method to the experimental AFM image. (A, E, I)
Portions of experimental snapshots that shows FlhAc molecule. (B, F, J) The snapshots that
have the highest correlation value to the experimental image superposed onto the synthetic
AFM images. Their RMSD values from the PDB structure were 1.687 nm, 1.836 nm, and 2.197
nm, respectively. The snapshots are drawn using VMD . (C, G, K) Synthetic AFM images
generated from the simulation snapshots that have the highest correlation value. (D, H, L)
Probability distributions in the simulation. The initial values of correlation are plotted by
dotted lines. The arrows point where the most correlated snapshots belong to.
32

Application to an Experimental AFM Image: A Flagellar Protein FlhAc
So far, we used synthetic-AFM images as a reference because the validation of the simulation

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

requires the knowledge of the ground truth; the reference structure. But, it is also necessary to
test our method with the real high-speed AFM image.
To test that, we used the experimental data of the cytoplasmic domain of a flagellar
protein FlhA of which the AFM measurement was recently reported . We choose three
snapshots from the high-speed AFM movie of a monomeric FlhA and took regions in which
FlhAc monomer can be identified (Figure 5A, E, I). For each AFM image chosen, we performed
40 independent flexible fitting simulations of 10 MD steps starting from the crystal structure
that are placed roughly at the center of the image regions. In all three cases, our simulations
found configurations that have higher correlation coefficients (Figure 5B, F, J) than that of the
initial configuration.
Interestingly, the results of flexible fittings are rather different in the three cases. Of
the three images, we obtained a best-fit conformation with the correlation coefficients (CCs),
0.8192 (the largest), 0.7658, and 0.7248 (the smallest), for Figure 5ABC, EFG, and IJK,
respectively. This order is anti-correlated with their RMSD values from the crystal structure,
1.687 nm, 1.836 nm, and 2.197 nm for Figure 5ABC, EFG, and IJK. respectively (Note that the
RMSD is not from the ground truth, but from the crystal structure, in this case). We also note
that for the case of Figure 5A image, the second-best CC = 0.8173 was obtained by a structure
with its RMSD = 0.776 nm, which is much closer to the native one. It seems that the larger CC
can be achieved when structures relatively close to the native one is compatible. Albeit unclear,
we can speculate a plausible reason; structures close to the native one is relative stable and
thus the protein stays in these conformations longer leading to a better CC, whereas structures
far from the native one are less stable and more dynamic so that the AFM images reflect some
averaged structures, resulting in poorer CCs. In a similar line, the probability distributions in
the RMSD and the CC (Figure 5D, H, and L) suggest that there is the larger correlation
between RMSD and CC as the best CC decreases; it also supports that structures far from the
native one is more dynamic and thus can be fit with poor CCs.
27

C,

C

8

DISCUSSIONS
In this work, we modeled the AFM stage-protein interaction as a simple
Lennard-Jones interaction that was uniformly applied on the xy-plane. In reality, the
interaction between stage and specimen is more complicated. The surface of a real stage is
actually composed of atoms. Thus, the stage potential would not be homogeneous in space.
There is the electrostatic interaction between specimen molecules and stage atoms, depending
on the chemical characteristics of the stage atoms. However, the interaction between stage and
specimen has not been analyzed in detail and the shape of the stage strongly depends on the
experimental setup and cannot be practically controlled in the atomic scale. Since the precise
information is not available, it is not appropriate, at this stage, to introduce an extra complexity

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

to a model. Therefore, here we employed the simplest interaction between the stage and the
specimen. Because our biasing potential is independent from the stage potential, we can
improve the stage potential with more accurate model of AFM stages, if necessary. Additionally,
our method will be useful to investigate the precise model of AFM stage because one can
optimize the parameter of AFM stage model and molecular structure simultaneously to make
the difference between structure model and experimental AFM image as small as possible.
It is known that HS-AFM image contains an artifact called parachuting effect in some
condition . Although the recent research provides some solution on to this problem , still it is
good to deal with such a kind of errors. Two ways to work around this problem can be considered.
The first one is to employ techniques accumulated in the field of image processing to remove
such effects. The second is to change the formulation of our biasing potential to emulate
parachuting effect. We used a symmetric gaussian function as a weighting function for
XY-plane in this work for simplicity. However, it is possible to consider asymmetric spatial
effects such as parachuting by changing weight asymmetrically according to the direction of
scanning lines.
We also show that the effectiveness of our biasing potential strongly depends on the
value of parameter Œ∫. From our simulations, we conclude that the value from 0.5 to 1.5 is an
appropriate range. It might depend on the shape of a target molecule and the size of the image
to fit; therefore, some pre-sampling might be needed. To fit images that is considered to
represent structures that are quite different from crystal structure, we may need to make our
biasing potential stronger than the current cases. To automate the parameter tuning, the
methods that are established for cryo-EM flexible fittings, e.g. changing potential strength
dynamically, might be useful .
We tested the applicability of our method to experimental AFM images. While
experimental images have an unpredictable noise, our method still found conformations that
have high correlations with the experimental images. Especially for images that seem to change
its conformation, however, some of the resulting conformations still look different from the
corresponding experimental image. There can be several reasons. First, the shape of the
cantilever tip may be less sharp than our expectation. To address this issue, we need to
calibrate the value of parameter  using experimental images that shows well predictable
object. Next, there can be an artifact from the unavoidable noises in experimental images. To
gain higher signal noise ratio, we can average several images as the current cryo-EM image
analysis normally does. Another way is to use temporal information that AFM movie contains.
Applying data-assimilation technique, we can use full information throughout the whole movie
and achieve more accuracy. There is another information source, the experimental setup. AFM
stage can have a charge distribution that modulates strongly to the orientation of the molecule.
By estimating and applying the electrostatic potential between specimen molecules and the
5

33

34

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

stage, the possible orientations and conformation will be restricted and then the resulting
conformation will be more accurate.
Additionally, although we applied our novel biasing potential to coarse-grained
molecular dynamics, it is potentially applicable to the all-atom fine-grained molecular
dynamics simulation. Since the underlying method that generates pseudo-AFM images by
combining smooth function works with atomic coordinates, there is no essential limitation to
apply our biasing potential to the atomic models. Practically, because of the resolution of the
available HS-AFM images, the atomic scale simulation might not be able to increase the quality
of the structural model compared to the required computational efforts. But it is still
interesting to run a short fine-grained molecular dynamics simulation with our biasing
potential with the atomic structures that is reconstructed by structural modeling based on the
result of our method.

CONCLUSION
In this work, we proposed and tested the flexible fitting MD simulations with a biasing
potential that quantifies the fitness to the experimental AFM image. We generated a smoothed
form of the pseudo-AFM image generation method from a structure and a biasing potential that
represents the correlation between the experimental and the structure-based AFM images. The
biasing potential is differentiable so that we can apply it directly to MD simulations. By
combining the AFM observations of biomolecules with MD simulation, our method would be a
powerful tool that connects single molecule experiments with structural changes of proteins at
work.
References
1. Shi, Y. A glimpse of structural biology through X-ray crystallography. Cell 159, 995‚Äì1014
(2014).
2. Murata, K. & Wolf, M. Cryo-electron microscopy for structural analysis of dynamic
biological macromolecules. Biochim. Biophys. Acta - Gen. Subj. 1862, 324‚Äì334 (2018).
3. Fernandez-Leiro, R. & Scheres, S. H. W. Unravelling biological macromolecules with
cryo-electron microscopy. Nature 537, 339‚Äì346 (2016).
4. Ando, T. High-speed atomic force microscopy coming of age. Nanotechnology 23, (2012).
5. Ando, T., Uchihashi, T. & Kodera, N. High-Speed AFM and Applications to Biomolecular
Systems. Annu. Rev. Biophys. 42, 393‚Äì414 (2013).
6. Dufr√™ne, Y. F. et al. Imaging modes of atomic force microscopy for application in
molecular and cell biology. Nat. Nanotechnol. 12, 295‚Äì307 (2017).
7. Ando, T. High-speed atomic force microscopy and its future prospects. Biophys. Rev. 10,

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

8.
9.
10.
11.
12.
13.
14.
15.
16.
17.
18.
19.
20.
21.
22.
23.

285‚Äì292 (2018).
Uchihashi, T., Iino, R., Ando, T. & Noji, H. High-speed atomic force microscopy reveals
rotary catalysis of rotorless F 1-ATPase. Science (80-. ). 333, 755‚Äì758 (2011).
Kodera, N., Yamamoto, D., Ishikawa, R. & Ando, T. Video imaging of walking myosin V
by high-speed atomic force microscopy. Nature 468, 72‚Äì76 (2010).
Shibata, M., Yamashita, H., Uchihashi, T., Kandori, H. & Ando, T. High-speed atomic
force microscopy shows dynamic molecular processes in photoactivated
bacteriorhodopsin. Nat. Nanotechnol. 5, 208‚Äì212 (2010).
Shibata, M. et al. Real-space and real-Time dynamics of CRISPR-Cas9 visualized by
high-speed atomic force microscopy. Nat. Commun. 8, 1‚Äì9 (2017).
Uchihashi, T. et al. Dynamic structural states of ClpB involved in its disaggregation
function. Nat. Commun. 9, 1‚Äì12 (2018).
Fuentes-Perez, M. E., Dillingham, M. S. & Moreno-Herrero, F. AFM volumetric methods
for the characterization of proteins and nucleic acids. Methods 60, 113‚Äì121 (2013).
Scheuring, S., Boudier, T. & Sturgis, J. N. From high-resolution AFM topographs to
atomic models of supramolecular assemblies. J. Struct. Biol. 159, 268‚Äì276 (2007).
Trinh, M. H. et al. Computational reconstruction of multidomain proteins using atomic
force microscopy data. Structure 20, 113‚Äì120 (2012).
Chaves, R. C. & Pellequer, J. L. DockAFM: Benchmarking protein structures by docking
under AFM topographs. Bioinformatics 29, 3230‚Äì3231 (2013).
Jaroslawski, S. et al. Structural models of the supramolecular organization of AQP0 and
connexons in junctional microdomains. J. Struct. Biol. 160, 385‚Äì394 (2007).
Miyagi, A., Chipot, C., Rangl, M. & Scheuring, S. High-speed atomic force microscopy
shows that annexin V stabilizes membranes on the second timescale. Nat. Nanotechnol.
11, 783‚Äì790 (2016).
Odorico, M. et al. Conformational dynamics of individual antibodies using computational
docking and AFM. J. Mol. Recognit. 26, 596‚Äì604 (2013).
Chaves, R. C., Dahmane, S., Odorico, M., Nicolaes, G. A. F. & Pellequer, J. L. Factor Va
alternative conformation reconstruction using atomic force microscopy. Thromb.
Haemost. 112, 1167‚Äì1173 (2014).
Li, W., Terakawa, T. & Takada, S. Correction for Li et al., Energy landscape and
multiroute folding of topologically complex proteins adenylate kinase and 2out-knot. Proc.
Natl. Acad. Sci. 109, 18625‚Äì18625 (2012).
Li, W., Wang, W. & Takada, S. Energy landscape views for interplays among folding,
binding, and allostery of calmodulin domains. Proc. Natl. Acad. Sci. U. S. A. 111, 10550‚Äì5
(2014).
Terakawa, T., Higo, J. & Takada, S. Multi-scale ensemble modeling of modular proteins

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

24.
25.
26.
27.
28.
29.
30.
31.
32.
33.
34.

with intrinsically disordered linker regions: Application to p53. Biophys. J. 107, 721‚Äì729
(2014).
Orzechowski, M. & Tama, F. Flexible fitting of high-resolution x-ray structures into
cryoelectron microscopy maps using biased molecular dynamics simulations. Biophys. J.
95, 5692‚Äì5705 (2008).
Ahmed, A., Whitford, P. C., Sanbonmatsu, K. Y. & Tama, F. Consensus among flexible
fitting approaches improves the interpretation of cryo-EM data. J. Struct. Biol. 177,
561‚Äì570 (2012).
Saijo-Hamano, Y. et al. Structure of the cytoplasmic domain of FlhA and implication for
flagellar type III protein export. Mol. Microbiol. 76, 260‚Äì268 (2010).
Namba, K. et al. Insight into structural remodeling of the FlhA ring responsible for
bacterial flagellar type III protein export. Sci. Adv. 4, eaao7054 (2018).
≈†ali, A. & Blundell, T. L. Comparative Protein Modelling by Satisfaction of Spatial
Restraints. J. Mol. Biol. 234, 779‚Äì815 (1993).
Kubo, S., Li, W. & Takada, S. Allosteric conformational change cascade in cytoplasmic
dynein revealed by structure-based molecular simulations. PLoS Comput. Biol. 13, 1‚Äì27
(2017).
Fermi, G., Perutz, M. F., Shaanan, B. & Fourme, R. The crystal structure of human
deoxyhaemoglobin at 1.74 √Ö resolution. J. Mol. Biol. 175, 159‚Äì174 (1984).
Kenzaki, H. et al. CafeMol: A coarse-grained biomolecular simulator for simulating
proteins at work. J. Chem. Theory Comput. 7, 1979‚Äì1989 (2011).
Humphrey, W., Dalke, A. & Schulten, K. VMD: Visual molecular dynamics. J. Mol.
Graph. 14, 33‚Äì38 (1996).
Kodera, N., Sakashita, M. & Ando, T. Dynamic proportional-integral-differential
controller for high-speed atomic force microscopy. Rev. Sci. Instrum. 77, 083704 (2006).
Miyashita, O., Kobayashi, C., Mori, T., Sugita, Y. & Tama, F. Flexible fitting to cryo-EM
density map using ensemble molecular dynamics simulations. J. Comput. Chem. 38,
1447‚Äì1461 (2017).

Table 1.

0.5 [nm]

1.0 [nm]

1.5 [nm]

2.0 [nm]

3.0 [nm]

4.0 [nm]

5.0 [nm]

bioRxiv preprint doi: https://doi.org/10.1101/793901; this version posted October 4, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

0.0 [deg]
5.0 [deg]
10.0 [deg]
15.0 [deg]

0.09
0.15
0.2
0.27

0.18
0.22
0.26
0.31

0.26
0.28
0.32
0.37

0.32
0.35
0.38
0.42

0.47
0.48
0.5
0.52

0.59
0.6
0.61
0.62

0.71
0.71
0.72
0.72

Acknowledgement
The study was supported mainly by the Japan Science and Technology Agency (JST) grant
JPMJCR1762 (ST), partly by the MEXT as ‚ÄúPriority Issue on Post-K computer‚Äù (ST), and by the
RIKEN Pioneering Project ‚ÄúDynamical Structural Biology‚Äù (ST). We appreciate Professor
Noriyuki Kodera giving us AFM image data and for lessons on the machinery of AFM. We
appreciate Suguru Kato for his technical supports and discussions. We thank Dr. Giovanni
Brandani, Dr. Cheng Tan, Diego Ugarte and Hana Slevin for fruitful discussions. We also thank
Shintaroh Kubo for giving a structure model of dynein and for discussions.

A

B

C

probe

pixel range

Œ∏

œÉ

gaussian
weight

r

z

molecular
model

D
0¬∞

tip radius

0.5nm
1.0nm
1.5nm
2.0nm
3.0nm

E

apex angle
5¬∞

10¬∞

15¬∞

x,y

exponential
weight

A

generate
pseudo-AFM
image

Add noise to
the image

C

molecular model

0.0 [nm]

1.0 [nm]

2.0 [nm]

3.0 [nm]

4.0 [nm]

5.0 [nm]

Monte-Carlo
simulation
randomize
orientation

B

D
correlation = 0.999

RMSD = 0.0298 [nm]

E

A

C

B

max cc = 0.915

max cc = 0.986

A

B

C

D
c.c. = 0.8192

E

F

G

H
c.c. = 0.7658

I

J

K

L
c.c. = 0.7248

