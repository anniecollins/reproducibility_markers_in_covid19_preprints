bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

1
2
3
4
5
6

Anticipatory Control of Momentum for Bipedal Walking on Uneven Terrain

7
8
9
Osman Darici1*, Hakan Temeltas2, Arthur D. Kuo1,3

10
11

1Faculty

of Kinesiology and 3Biomedical Engineering Program, University of Calgary, Calgary,

12
13

Alberta, Canada
2Istanbul

Technical University, Control and Automation Engineering, Istanbul, Turkey

14
15

*Corresponding author: osman.darici1@ucalgary.ca

16
17
18
19
20
21
22
23
24
25
26
27

A manuscript submitted for consideration by Scientific Reports

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

Abstract

2

Humans and other walking bipeds often encounter and compensate for uneven terrain. They

3

might, for example, regulate the bodyâ€™s momentum when stepping on stones to cross a stream.

4

We examined what to do and how far to look, as a simple optimal control problem, where

5

forward momentum is controlled to compensate for a step change in terrain height, and steady

6

gait regained with no loss of time relative to nominal walking. We modeled planar, human-like

7

walking with pendulum-like legs, and found the most economical control to be quite

8

stereotypical. It starts by gaining momentum several footfalls ahead of an upward step, in

9

anticipation of the momentum lost atop that step, and then ends with another speed-up to

10

regain momentum thereafter. A similar pattern can be scaled to a variety of conditions, including

11

both upward or downward steps, yet allow for considerably reduced overall energy and peak

12

power demands, compared to compensation without anticipation. We define a â€œpersistence

13

timeâ€ metric from the transient decay response after a disturbance, to describe how momentum

14

is retained between steps, and how far ahead a disturbance should be planned for. Anticipatory

15

control of momentum can help to economically negotiate uneven terrain.

16
17

Introduction

18

Humans and other bipeds often encounter uneven terrain in walking environments. Even the act

19

of stepping between curb and sidewalk can perturb otherwise steady walking and cause a loss of

20

stability and forward speed. Although gait may be restored with feedback control, there may be

21

advantages to anticipating the upcoming disturbance, for example through vision or other

22

imaging, and performing compensations before stepping on it. Although it may seem

23

advantageous to anticipate ahead of time, it is unknown how far ahead to look, what actions to

24

take, and at what cost to restore nominal gait. A simple modeling analysis can yield insight on

25

how best to anticipate and compensate for a terrain disturbance.

26
27

Anticipation offers a potential advantage in time. Whereas a feedback response cannot be

28

initiated until a disturbance has been physically encountered, anticipatory control can be

29

initiated immediately upon its (visual) detection. It can thus distribute control actions both before

2

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

and after the disturbance, and potentially compensate more economically or with less actuator

2

effort. A simple example is the running long jump, which builds up more momentum and yields

3

a longer jump than can be gained from a static, standing position. Similar benefits might apply to

4

traversal of a minor terrain disturbance, with appropriate anticipation and planning.

5
6

We will address anticipation and integration as a simple optimization problem (Fig. 1). One

7

simplification is to consider only a single disturbance in terrain height (â€œup-stepâ€ or â€œdown-stepâ€).

8

Many a person has experienced a stumble or fall from a small, unexpected disturbance, as has

9

many a bipedal robot. In fact, an up- or down-step is often used as a test of a robotâ€™s robustness

10

to uneven terrain1,2. An additional simplification is to consider a minimal, sagittal plane model of

11

bipedal walking, in which momentum is carried by a pendulum-like stance leg, and additional

12

degrees of freedom for the swing leg or lateral motions are ignored (or controlled by lower-level

13

feedback loops). Pendulum-like, underactuated locomotion describes some aspects of human

14

walking e.g.3,4, and that of a number of robot models5â€“7 and physical machines8â€“12.

15

Underactuation implies that energy change occurs little during stance, but substantially with a

16

relatively rigid swing legâ€™s collision with ground13â€“15, as part of the â€œstep-to-step transitionâ€16. The

17

energy and momentum losses from collision, and the positive work done to offset these losses,

18

are key to the optimization solutions.

19
20

The proposed optimization modulates forward momentum to mitigate the effects of a single

21

terrain height disturbance (an â€œup-stepâ€ or â€œdown-stepâ€). The goals will be to regain a nominal

22

walking gait without falling down, and without loss of time, so that the biped will eventually be

23

at an appointed time and position, as if had always been on level terrain. Of course, there may

24

be some demands on overall or peak work of muscles or actuators, and so these will be minimized

25

or evaluated as part of the optimization. Here we present the dynamics of a simple model (Fig.

26

1), followed by an optimization formulation to address these questions. This is then followed by

27

a series of simple observations regarding how to anticipate and recover from a terrain

28

disturbance.

29

3

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

Figure 1. Simple model of walking over a
single up- (or down-) step. (a) Body
center of mass (COM) is a point mass
carried atop stance leg acting as an
inverted pendulum, encountering step of
height ğ‘. (b) Model has mass ğ‘€ at pelvis,
massless legs of length ğ¿, gravitational
acceleration ğ‘”, and fixed step length ğ‘†,
with inter-leg angle 2ğ›¼. Stance leg angle
is measured with angle ğœƒ as shown. (c)
Level nominal walking has step-to-step
transition where COM velocity is
redirected from forward-and-downward
ğ‘£ğ‘–âˆ’ to forward-and-upward ğ‘£ğ‘–+ , with
active, impulsive trailing leg push-off
(PO), followed by inelastic, impulsive,
leading leg collision (CO). (d) Up-step
occurs on step ğ‘– = 0, with two cases:
pre-emptive and late push-off, which
both perform positive work (ğ‘¢0 and ğ‘¢0+ ,
respectively) but earlier or later than
collision. (e) Optimization is to modulate
ğ‘ push-offs to minimize their total work
while accommodating the up-step in the
same time as level walking at speed ğ‘‰.
The ğ‘ steps are nominally centered on
the up-step for equal anticipation and
recovery, but may be shifted by ğ‘š steps
relative to obstacle. Up-step heights
have positive ğ‘; down-steps negative ğ‘.

1
2

Results

3

We found substantial advantages to anticipating and compensating for an up-step. We first found

4

that without compensation, an up-step causes a considerable loss of time. The lost time may

5

then be regained by speeding up from nominal walking, but even the optimal speed-up places

6

considerable demands on overall work and peak actuator power. We then found that the optimal

7

compensation is instead to anticipate and adjust forward momentum or speed in a transient

8

period starting before and ending after the up-step. Results show that a single compensation

9

pattern can be scaled to characterize optimal strategies for different walking speeds and step

10

heights, including down-steps.

11
12

Uncompensated transient response resembles exponential decay and is described by

13

persistence time
4

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

The benchmark for optimal compensation strategies is the effect of a completely uncompensated

2

up-step. Uncompensated control means that only the nominal, pre-emptive push-off is applied17

3

(ğ‘¢ğ‘– = ğ‘ˆ), without any modulation. The transient response resembles an exponential decay,

4

starting with an immediate loss of speed at the up-step, followed by an approximately

5

exponential response over subsequent discrete steps (step index ğ‘–; equation 2). We defined the

6

time constant of the exponential decay as a persistence time (see Methods), to characterize how

7

compensations scale over a wide range of walking speeds and disturbances.

8
9

There is considerable advantage to pushing off onto the up-step pre-emptively. If the up-step can

10

be anticipated only enough to allow push-off to occur before the collision, it can greatly reduce

11

the immediate loss of speed compared to a late push-off17. For a sample up-step of modest height

12

(ğ‘ = 0.025ğ¿), loss of speed is about 80% less and time loss is 82.7% less (see Fig. 2a-b).

13

Continuing with nominal push-offs after the up-step, both cases experience a similar type of

14

exponential decay in speed error, and therefore an asymptotic return to nominal walking (Fig.

15

2b). But pre-emptive push-off reduces the total time loss by 82% compared to late push-off (for

16

ğ‘ =0.025ğ¿), even if push-off magnitude is not actively modulated. Thus, even a short-range

17

ability to detect an upcoming obstacle can be helpful, if it allows for an unmodulated but still pre-

18

emptive push-off.

19
20

The eventual total time loss also increases sharply with up-step height (Fig. 2c). This is because

21

the potential energy of the up-step comes at the expense of (and must not exceed) the modelâ€™s

22

kinetic energy, and therefore speed (see velocity ğ‘£0+ ; equations 2 and 7). As a result, a faster

23

nominal walking speed is relatively less sensitive to up-step (compare different speeds in Fig. 2c).

24

5

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1
2
3
4
5
6
7
8
9
10

Figure 2. Effect of an uncompensated up-step. (a) Speed fluctuations vs. time, for an up-step at time 0 with constant
push-off. Model experiences transient disturbance from nominal speed due to up-step, with smaller effect if pushoff occurs pre-emptively as opposed to late. Each dot (filled symbol) indicates a discrete step, with speed ğ‘£ğ‘– sampled
at mid-stance (see Fig. 1e). (b) Cumulative time gain vs. time shows accumulating effect of speed loss, with
asymptote towards a total time loss (negative time gain). (c) Total time gain vs. up-step height ğ‘ for various nominal
walking speeds, with greater bumps causing greater loss of time, and smaller effect for faster nominal speeds. Also
shown are effects of late push-off (unfilled symbols). Up-step height ğ‘ = 0.025ğ¿, nominal mid-stance velocity ğ‘‰ =
0.44ğ‘”âˆ’0.5 ğ¿0.5 . Conditions are equivalent to a human walking at 1.5 m/s, encountering an up-step of 2.5 cm.

11

The transient responseâ€™s decay (Fig. 2a) is well characterized by persistence time. For the nominal

12

gait, the persistence time is about 2.61 steps, equivalent to about 1.39 seconds or 2.06 m for

13

nominal, human-like walking. This is equivalent to a 90% settling time of about 5.7 steps.

14
15

Time may be gained from steady-state walking with a (costly) burst of speed

16

Given the total time lost from a disturbance, a naÃ¯ve compensation is simply to regain that time

17

with an isolated time gain, meaning a separate burst of speed from nominal, level walking. The

18

appropriate amount of time ğ‘¡gain could be gained either well before or well after nominal speed

19

is disrupted. In either case, the time is to be gained within a burst of ğ‘ fast steps, starting and

20

ending at the nominal steady-state speed ğ‘‰, while minimizing total push-off work.

21
22

The optimal burst of speed rises smoothly to a single peak, and then decreases back to nominal,

23

with a roughly time-symmetric profile (Fig. 3 top). The corresponding push-off sequence (Fig. 3

24

top) is neither smooth nor symmetric. The peak push-off work occurs on the initial compensation

6

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

step, with considerably greater magnitude than nominal, about 1.78 times greater for a sample

2

up-step (ğ‘ = 0.075ğ¿; ğ‘ = 9). The succeeding push-offsâ€”save the final oneâ€”decrease rapidly

3

and then level off above normal, as time is recouped. The final compensatory push-off is actually

4

below nominal, to enable speed-matching for the final conditions. This asymmetric push-off

5

profile nonetheless contributes to a rather smooth accumulation of time gain, resembling a ramp

6

function with rounded corners (Fig. 3 top).

7
Gaining time from level nominal walking
Speed fluctuations vs. time

Push-off work vs. time

Cumulative time gain vs. time

0.5

0.2

More time gain

(g â€“ 0.5L0.5)

Time gain

More time gain

0.3

12
10

running
threshold

8
6

leaping
threshold

4

Nominal

0.1

1.5 m/s

0

N=9

0.4

Push-off work

0.5

max feasible
time gain

14

N=9

(MgL)

More time gain

(g 0.5L0.5)
1.0

Time gain
0.5
2
4
6
8

Speed vi

Varying time gain tgain

1.5

2

speeding up

N=9

-5

0

5

Time

-5

0

0

5

Time

(g â€“ 0.5L0.5)

-5

0

5

Time

(g â€“ 0.5L0.5)

(g â€“0.5L0.5)

0.2

speeding up
N

0.1

8
9
10
11
12
13
14
15

# steps N
2
3
5
7
9
19

1.5 m/s

tgain = 0.5 g â€“0.5L0.5
-15

-10

-5

0

Time

5

10

15

(g â€“0.5L0.5)

1.0

0.8

0.6

Time gain

0.3

0

(MgL)

Nominal

Push-off work

0.5

1.2

More steps N

Speed vi

(g 0.5L0.5)

0.6

0.4

0.5

More steps N

Varying number of steps N

0.7

0.4

0.3

More steps
N

0.2

0.4

Nominal

0.2

0

-15

-10

-5

0

Time

(g â€“ 0.5L0.5)

5

10

15

(g â€“0.5L0.5)

0.1

0

-15

-10

-5

0

Time

5

10

15

(g â€“0.5L0.5)

Figure 3. Optimal strategies to gain time during level walking, separate from any disturbance, for (top row:) varying
amounts of time ğ‘¡gain , and (bottom row:) varying number of steps ğ‘. Each row, from left to right: Speed fluctuations
vs. time, push-off work vs. time, and cumulative time gain vs. time, relative to nominal (each step denoted by filled
symbol). Parameter values are ğ‘ = 9 steps for top row, ğ‘¡gain = 0.5 for bottom row. Filled dots indicate steps.
Unfilled dots denote large push-offs that entail momentary aerial phases or even running for several steps; maximum
time gain thresholds to avoid such cases are shown in (top most right).

7

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

These effects are amplified as more time is gained (Fig. 3 top). The greater the ğ‘¡gain (at fixed ğ‘),

2

the greater both the peak speed and peak push-off. It is also easier to take more compensation

3

steps ğ‘, which calls for a shallower peak in walking speed, a lower peak push-off, and a more

4

gradual gain, with less time gained per step (Fig. 3 bottom). Conversely, gaining time over very

5

few steps entails a sharp peak in both speed and push-off (Fig. 3 bottom). In terms of both overall

6

and peak amount push-off work, there is great advantage to spreading a time gain over as many

7

steps as possible (Fig. 3 bottom).

8
9

Another issue with gaining time is the limitations of a walking gait. A sufficiently large push-off

10

may cause the model to lose ground contact (or leap) into a momentary aerial phase prior to

11

collision (see equation 2), particularly for the first push-offs of the compensation (Fig. 3 top). This

12

might resemble a straight-legged run for a few steps. If such leaping were disallowed, the

13

maximum time that could be gained would be equivalent to about 2.86 nominal step times (ğ‘‡).

14

In addition, large enough time gains can call for running, when speed is too high for pendulum-

15

like walking3, ğ‘£ğ‘– â‰¥ 1 ğ‘”0.5 ğ¿0.5. We did not explicitly model running here, and instead noted which

16

steps or time gains would exceed the thresholds for maintaining a pure walking gait.

17
18

The primary issue is the number of steps over which time is to be gained. For fewer steps or more

19

time gain, there are substantial penalties with regard to peaks in walking speed, peak and overall

20

work, and the potential need for aerial phases. For relatively large ğ‘, the speed and push-off

21

profiles become increasingly constant (Fig. 3 bottom), so that the primary cost is dominated by

22

the work for steady walking at an elevated speed. For large ğ‘, the extra work needed to gain

23

time is largely inversely proportional to ğ‘. If time needs to be gained, it should ideally be

24

distributed across as many steps as possible.

25
26

Optimal strategy for an up-step: Speed up, lose speed, speed up

27

Optimization reveals that the ideal compensation strategy should actually envelop the up-step.

28

A near-optimum may be achieved with a relatively small ğ‘, with little advantage to taking more

29

steps. Moreover, these ğ‘ steps should optimally be centered about the up-step, with ğ‘š = 0. The

8

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

best strategy is not to gain time separately from the disturbance, but to modulate push-offs in

2

anticipation of it, and to continue doing so after encountering it. Here we describe the optimal

3

strategies in terms of speed or momentum fluctuations, push-off modulation, and cumulative

4

time gain.

5

v

6
7
8
9
10
11
12

Figure 4. Optimal strategies to compensate for an up-step, for (top row) varying number of steps ğ‘, and (bottom
row) varying step height ğ‘. Each row, from left to right: Speed ğ‘£ğ‘– vs. time, push-off work vs. time, and cumulative
time gain vs. time. In top row, step height is fixed (ğ‘ = 0.075ğ¿), and optimal solutions shown are for linearized
model, superimposed on nonlinear model solutions (dashed lines). In bottom row, both up- and down-step (positive
and negative ğ‘, respectively) solutions are shown for linearized model; ğ‘ = 9. Optimal strategies are all centered
about the up-step (ğ‘š = 0).

13

The key to reducing overall work is to ramp up speed (momentum) in a few steps immediately

14

preceding the disturbance (Fig. 4 top), pushing off hardest when stepping onto it. This anticipates

15

a sharp loss in speed atop the up-step, followed by a gradual return to nominal speed, with

16

approximately two-fold symmetric profile: symmetric in time about the up-step, and in speed
9

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

about nominal speed profile. The associated push-offs increase to a high peak centered on the

2

up-step itself (ğ‘¢0 ), and otherwise remain close to nominal for all but a few steps surrounding that

3

step. The push-off profile is also approximately symmetric in time about the up-step, with the

4

exception of the ğ‘th push-off, which serves a special purpose of matching the final boundary

5

conditions. In terms of cumulative time, the strategy reserves the few final steps to gain time in

6

anticipation of the time lost on and after the up-step. We found little difference to using

7

linearized vs. nonlinear dynamics (solid vs. dashed lines, respectively in Fig. 4 top), and therefore

8

use linearized dynamics for following analyses.

9
10

The compensations increase in magnitude with fewer compensatory steps (Fig. 4 top) or larger

11

up-step heights (Fig. 4 bottom). The extreme case is the minimum possible steps, ğ‘ = 2, which

12

generally call for a large speed-up and a large peak push-off. Not surprisingly, the amplitudes of

13

both speed and push-off profiles increase with bump height. Moreover, the profiles scale

14

approximately linearly for small ğ‘. But regardless of the number of steps and the height to be

15

gained, the optimal compensation largely occurs within Â±2ğ‘‡persist of the up-step.

16
17

The optimal strategy takes unique advantage of the dynamics of the up-step. There is a unique

18

reduction of kinetic energy exchanged for the up-stepâ€™s potential energy, which accounts for a

19

substantial loss of speed during the single upward step. That transient loss is compensated for

20

by speeding up in two bouts, before and after the up-step. Speeding up is economical because

21

the larger push-offs result in reduced collisions. It is optimal to mostly concentrate loss of speed

22

into a single step, and to distribute the accelerations across many steps. This is illustrated by the

23

case of many steps (e.g. see Fig. 4 top, ğ‘ = 19), where there is slight advantage to first slowing

24

down slightly, to extend the speed-up prior to the up-step.

25
26

We additionally observe that the optimal compensation for a down-step (Fig. 4 bottom), largely

27

mirrors that for an up-step. The actions largely scale with step height, so that negative heights

28

(down-steps, ğ‘ < 0) entail slowing down rather than speeding up ahead of the disturbance and

29

reducing push-offs instead of increasing. Similarly, the cumulative time change is also nearly

10

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

opposite to an up-step, except with time being deliberately lost instead of gained, in anticipation

2

of the kinetic energy gained from stepping down. This scaling effect occurs about the nominal

3

speed, push-off, or time gain, and is not quite linear, owing to the nonlinear dynamics (equations

4

2 & 9). Nevertheless, scaling of compensation with step height ğ‘ serves to roughly describe the

5

optimal solution for both up- and down-steps. Down-step strategies will be examined further in

6

another section below.

7
8

Earlier or later compensations are more costly

9

The optimality of centering the compensation about the up-step is illustrated by the costs of

10

doing otherwise (Fig. 5). Shifting the compensation earlier or later (ğ‘š < 0 or ğ‘š > 0, respectively)

11

and optimizing for each case, reveals increasing costs for total push-off work (Fig. 5a) and peak

12

push-off work (Fig. 5b).

13
14

There is still more cost if the compensation occurs entirely before or after the disturbance.

15

Compensating early with no overlap (ğ‘š < âˆ’

16

separate time gain (Fig. 3), with an equivalent higher cost. Compensating later (ğ‘š >

17

tends toward the same higher cost, albeit with a longer transition. This is due to the transient

18

response after the disturbance, in which the total time loss accumulates over several persistence

19

times ğœ. Beginning the compensation during the transient therefore means that less time is to be

20

regained, and so the overall work cost only gradually increases towards an asymptote (Fig. 5a),

21

namely the cost for gaining time separately. The peak push-off also tends toward its

22

corresponding asymptote (Fig. 5b), albeit with elevated costs in some cases. These transition

23

cases reinforce that the optimal compensation should envelop up-step symmetrically.

(ğ‘+1)
2

) is essentially equivalent to a completely
(ğ‘+1)
2

) also

24
25

A large number of steps is not necessary to obtain near-optimal total work or peak push-off work.

26

Although both costs (Fig. 5c and d) decrease with greater ğ‘, the returns diminish rapidly. For

27

example, taking the minimum of two compensatory steps only takes about 12% more extra work

28

than for nine (ğ‘ = 9; ğ‘ = 0.075ğ¿). Beyond about two persistence times (2ğ‘‡persist ), the costs are

29

nearly indistinguishable. There is little to be gained from looking more than a few steps ahead.
11

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1
2

The optimal strategy has considerable advantages over an isolated time gain, separate from the

3

up-step. For the sample comparison (Fig. 5), the optimum overall work is roughly half that for a

4

completely separate time gain (compare minimum with asymptote in Fig. 5a). There is also a high

5

cost penalty for failing to anticipate the up-step at all, and starting the compensation after a late

6

push-off17. A similar but smaller advantage is observed in peak push-off. However, there is a

7

special case of a compensation that ends just before the up-step (ğ‘š = âˆ’(ğ‘ + 1)/2 in Fig. 5b),

8

where peak push-off is reduced, albeit at a slight cost in total work.

9
10

It is interesting to note that the optimal strategy is generally less costly than the potential energy

11

of the up-step itself. One might expect a cost equal to the work for level nominal walking, plus

12

the work needed to lift the body up the step. But here (Fig. 5), the overall added cost is about

13

58.5% of the potential energy gain, and the peak push-off is about 71.5%. As stated earlier, the

14

optimal strategy actually gains advantage from the up-step.

15
16
17

12

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1
2
3
4
5
6
7
8
9
10
11
12

Figure 5. Costs for optimal compensation strategies, as a function of compensation timing (shifting by ğ‘š relative to
up-step, see Fig. 1) and the number of compensation steps (ğ‘). (a) Total extra work vs. ğ‘š, for ğ‘ compensatory steps
(ğ‘ = 9, ğ‘ = 0.075ğ¿). Total extra work is defined as the work in excess of ğ‘ nominal steps. Filled symbols indicate
cost for each ğ‘š, lighter horizontal lines indicate compensation range of ğ‘ steps. (b) Peak push-off work vs. ğ‘š. (c)
Total extra work vs. ğ‘, and (d) Peak push-off work vs. ğ‘ for optimal compensation centered about up-step (ğ‘š = 0).
Also shown is the cost of an isolated time gain from nominal walking (Fig. 3), to regain time lost from an equivalent
up-step (ğ‘ = 0.075ğ¿, ğ‘¡gain = 2.48 ğ‘”âˆ’0.5 ğ¿0.5 ) with no compensation. In (a) and (b), minima for both total and peak
work occur at ğ‘š = 0, where compensatory steps are distributed equally before and after the disturbance. Both costs
also decrease for greater ğ‘. Also shown in (a) is the optimal strategy for recovering from an unanticipated up-step
with a late push-off on the up-step.

13

Optimal strategies are self-similar despite parameter variations

14

The optimal strategies have similar speed profiles even for different parameter values for average

15

speed and step length (Fig. 6). Taking greater (fixed) step lengths while keeping average walking

16

speed fixed, the optimal compensations have similar shape but in fewer steps and less amplitude

17

(Fig. 6a). The speed profiles are also similar to each other when increasing speed while keeping

18

step length fixed (Fig. 6b), although the amplitudes decrease. Thus, for a wide range of parameter

19

values, the compensation strategy always calls for speeding up ahead of an up-step, losing speed

20

atop the up-step, and then recovering speed for several steps after it.
13

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1
2

All of these effects may be summarized in terms of persistence time. Whether varying speed or

3

step length, the optimal compensation maintains approximately the same profile (albeit varying

4

amplitude) and takes place within about Â±2ğ‘‡persist . In fact, including all parameter variations

5

considered thus far (e.g., number of steps, step height), the speed fluctuation profiles are nearly

6

the same when normalized by persistence time (Fig. 6c). Persistence time is helpful for

7

summarizing the combined effects of a discrete, once-per-step collision, and the continuous-time

8

dynamics of the pendulum-like stance leg. It also plays a large role in the optimal compensation,

9

whether stepping up or down, or walking at a range of speeds and step lengths.

10

11
12
13
14
15
16
17
18

Figure 6. Effect of parameter variations on optimal strategies. (a) Optimal speed fluctuations for different values of
step length parameter (via leg angle ğ›¼; constant average speed). (b) Optimal speed fluctuations for different average
speeds (via step frequency; constant leg angle ğ›¼). In both (a) and (b), ğ‘ = 0.075ğ¿ and ğ‘ = 9. (c) Speed fluctuations
for all parameter variations considered thus far, scaled by persistence time. Superimposed are variations in number
of steps ğ‘ (Fig. 4 top), step height ğ‘ (Fig. 4 bottom), step length, and speed. All amplitudes are plotted relative to
respective nominal speed, and have been normalized to unity positive peak. Speed fluctuations for negative step
heights are shown negated to facilitate comparison.

19
20

Up- and down-step strategies are related due to time-symmetry

21

The optimal strategy to compensate for a down-step is a simple time-reversal of the up-step

22

strategy (Fig. 4 bottom). The speed profile for the down-step (ğ‘ < 0) is the same as for the up-

23

step except with time running backwards. In fact, the push-off profile for a down-step is the same

24

as the time-reversed up-step profile, except using the up-step collisions as the down-step push-

14

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

offs. Similarly, the cumulative time gain is reversed in time, where down-step time loss is

2

equivalent to up-step time gain.

3
4

Time-reversal symmetry is explained by two basic principles. First, the walking dynamics have

5

time-symmetry. The push-off and collision impulses act the same and differ only in which leg they

6

apply to (trailing and leading leg, respectively), and in the order of execution. As a result, the

7

same dynamics may be played forward or backward in time, and the model walks in one direction

8

or the other (to right or left of Fig. 1). For example, the push-off profile for a down-step (e.g., ğ‘ =

9

âˆ’0.05ğ¿ in Fig. 4 bottom) may be flipped about the (vertical) work axis (at ğ‘¡ = 0) to yield the

10

collision profile for an equivalent up-step (ğ‘ = 0.05ğ¿).

11
12

The second principle is that minimizing push-offs and minimizing collision magnitudes yield the

13

same solution. This is because the boundary conditions enforced here call for nominal level

14

walking at the same speed, and thus no difference in kinetic energy between start and end. The

15

only energy difference is in the potential energy of the step (ğ‘€ğ‘”ğ‘). The only energy sources and

16

sinks are the push-offs and collisions, and so the sum of all push-offs and collisions must equal

17

the potential energy, which is fixed for a given optimization problem. In addition, push-offs can

18

only perform positive work, and collisions negative work. Any solution that minimizes total push-

19

offs must therefore also minimize the total collision magnitudes.

20
21

Next is to apply time-symmetric dynamics to the optimization. The optimal strategy to traverse

22

an up-step with minimal push-off work (e.g., Fig. 4 top) may be played in reverse, to yield the

23

optimal strategy to traverse a down-step with minimal collision work magnitude. But minimizing

24

collision magnitude is the same as minimizing push-off, and so the same strategy, whether played

25

forward or backward in time, minimizes the respective push-offs for either direction.

26
27

Discussion

28

We explored the optimal strategy for anticipating and compensating for a single up- (or down-)

29

step on otherwise flat terrain. The uncompensated effect of the disturbance was characterized

15

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

in terms of a transient response with a loss of time and forward momentum, followed by an

2

asymptotic return to nominal walking. For planned tasks, it may be desirable to regain the lost

3

time, which was examined in two cases: one where time is regained by speeding up level walking,

4

and the other, optimal case, where the compensatory steps are distributed both before and after

5

the step. The analysis yields several conclusions regarding optimal compensations.

6
7

One conclusion is that there is a single, consistent pattern to optimally compensating for an up-

8

step. That pattern consists of speeding up prior to the up-step, losing speed (and time) ascending

9

that step, and then speeding up again after it (Fig. 4). With appropriate scaling, that basic pattern

10

applies regardless of the number of compensation steps, the up-step height, the walking speed,

11

or the step length (see Fig. 6). For example, the patternâ€™s timing scales largely in accordance with

12

the persistence time, which is determined by the speed and step length (see Methods, equation

13

10). The patternâ€™s amplitude also scales, for different heights (including down-steps), speeds, or

14

step lengths, but relatively little with the number of compensation steps. In fact, although there

15

is always an advantage to taking more steps, there is rather little advantage beyond ğ‘ = 3 steps.

16

A general rule of thumb is that the optimal compensation should largely occur within Â±2

17

persistence times of the up- (or down-) step.

18
19

This strategy is also clearly superior to gaining time separately during level walking. For example,

20

the optimal compensation in five steps requires 51.3% less total extra work and 8.5% less peak

21

work (ğ‘ = 5, ğ‘ = 0.075ğ¿; see Fig. 5), while also having less sensitivity to the number of

22

compensation steps. This is because a separate time gain is largely a matter of walking faster,

23

which is costly on level ground. But the transient loss of speed and time from the up-step allows

24

opportunity to reduce collision losses over two bouts of acceleration. Less energy is lost to

25

collisions when either accelerating or stepping upward, and the optimal compensation takes full

26

advantage of such opportunities.

27
28

16

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

These results help to reinforce the benefits of looking ahead. Vision (or other imaging) is certainly

2

critical for spatial path planning, for example to determine feasible paths to avoid obstacles. But

3

the dynamics of legged locomotion are such that planning can also be performed dynamically, in

4

terms of momentum trajectories. Knowledge of upcoming terrain variations can allow not only

5

for economy, but also for surmounting obstacles that might otherwise exceed actuator

6

limitations. An up-step can thus be surmounted with less loss of time, less overall work, and

7

reduced peak push-off compared to the up-stepâ€™s gravitational potential energy.

8
9

This has potential implications for control of legged robots. Perhaps the most straightforward

10

control for robots, and also the most important for stability, is state feedback control. Such

11

control might automatically regulate walking speed toward a nominal reference value, but would

12

not normally be expected to make up for lost time, unless time were included as an explicit goal,

13

and perhaps included as an explicit state (e.g., integrated error in the feedback controller). Even

14

then, responding after a disturbance (see separate time gain, Fig. 3; or later timing, Fig. 5) cannot

15

be as economical as the optimum (ğ‘š = 0, Fig. 5). Although the true optimum appears to require

16

infinite look-ahead, near-optimal performance is possible with only about two persistence times

17

(or distances) of foresight. Although such compensation could be stored as a scalable trajectory

18

(e.g., Fig. 6c), an alternative would simply be a model predictive control18, where an optimal plan

19

is continually regenerated with a receding horizon. That horizon need only be about two

20

persistence times ahead, and might be compatible with other optimization approaches already

21

employed for some legged robots19â€“22.

22
23

Our analysis may suggest how humans negotiate small obstacles. Humans rely on vision to

24

identify curbs or height discrepancies in a sidewalk, and the resulting compensations may do

25

more than simply prevent tripping. It is possible that humans speed up prior to a stepping up a

26

curb, and perhaps slow down prior to stepping down a curb23. They appear to look several steps

27

ahead24 and make quick, dynamically sensible decisions. Moreover, they appear to control not

28

only speed but also foot placement, while taking into account actuator limitations. It is unknown

17

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

how humans actually plan their momentum or whether they control it optimally. The optimal

2

strategies considered here might serve as a reference for comparison to humans.

3
4

The compensation strategies examined here are focused on pendulum-like walking. Our step-to-

5

step transition analysis treats the leg as relatively straight when it contacts ground. This may

6

apply well to relatively small up-steps, but not to larger ones. Humans normally flex the swing

7

knee at mid-stance, in part to gain ground clearance, and then extend again prior to ground

8

contact25. But swing knee extension does not seem to apply for larger inclines or typical stairs,

9

where there may be less forward momentum. Compensation strategies might be different for

10

larger up-steps, and especially for less pendulum-like gaits.

11
12

The present analysis has a number of additional limitations. Our model has fixed step length and

13

width, and performs impulsive step-to-step transitions, whereas humans actually modulate step

14

distances, and perform step-to-step transitions over finite time. The actual costs of varying

15

speed26 might therefore differ from that considered here. The model is also confined to

16

dynamical planning of push-offs and speed, assuming that the spatial path is already determined.

17

An improved model could allow for three-dimensional stepping27,28 with multiple joints that allow

18

for leg compliance29 and finite-duration step-to-step transitions, and might combine spatial and

19

dynamical planning into a single optimization problem.

20
21

Despite these limitations, there may be some general conclusions that may yet apply to more

22

complex models. Even with additional degrees of freedom, walking is often dominated by

23

forward momentum, and the step-to-step transition may dissipate significant energy, which must

24

then be restored with active work. It may therefore be advantageous to counter a step height

25

disturbance by gaining momentum several steps beforehand and continuing the compensation

26

past the disturbance for several steps thereafter. Furthermore, the appropriate compensation

27

range may be described by a measure such as persistence time. Without planning,

28

compensations for uneven terrain may come with a relatively high cost in overall work, peak

18

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

actuator demands, and/or number of compensation steps. There may be considerable advantage

2

to applying optimization to the dynamics of legged locomotion, particularly on uneven terrain.

3
4

Methods

5

Model of walking

6

The walking model has rigid, pendulum-like legs whose ground collisions dominate the energetics

7

(Fig. 1a). It has a point-mass pelvis of mass ğ‘€, atop massless legs taking fixed-length steps (Fig.

8

1b). The stance leg behaves like an underactuated, inverted pendulum during single support,

9

punctuated by the â€œstep-to-step transitionâ€ to redirect the center-of-mass (COM) velocity

10

between steps14. This is accomplished with an active push-off along the trailing leg, followed

11

immediately by an inelastic heel-strike collision along the leading leg, both modeled as ideal

12

impulses in immediate succession (Fig. 1c). A full walking step therefore starts with a push-off

13

then a collision and followed by pendular stance phase that ends just before the next leg contacts

14

ground. Middle stance (mid-stance) is defined as the instant that the stance leg is upright within

15

the stance phase. When the terrain disturbance is encountered (Fig. 1d), we consider cases

16

where push-off occurs pre-emptively or late, relative to collision. In the optimal case (Fig. 1e),

17

terrain variations are sensed in advance, and pre-emptive push-offs are to be planned. We

18

previously examined a similar model17, and found that failure to anticipate and perform push-off

19

pre-emptively, for example on uneven terrain, results in considerably poorer economy.

20
21

The model dynamics are briefly summarized as follows (detailed previously17): Each step has

22

index ğ‘– with the disturbance located at ğ‘– = 0 (Fig. 1d). Negative ğ‘– therefore refer to the

23

preparatory steps beforehand, and positive to recovery steps thereafter. Each step begins just

24

before the step-to-step transition, with COM velocity ğ‘£ğ‘–âˆ’ directed forward and downward as

25

dictated by the preceding stepâ€™s stance phase. The ideal step-to-step transition starts with pre-

26

emptive push-off work ğ‘¢ğ‘– (in units of mass-normalized work) performed impulsively along the

27

trailing leg to redirect the COM velocity. Applying impulse-momentum (and normalizing by body

28

mass) yields an intermediate velocity of magnitude ğ‘£ğ‘–0 ,

29

19

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

ğ‘£ğ‘–0 = âˆš(ğ‘£ğ‘–âˆ’ )2 + 2ğ‘¢ğ‘– .

1

(1)

2
3

This is followed immediately by the heel-strike collision along the leading leg, to yield post-

4

collision velocity ğ‘£ğ‘–+ . Again applying impulse-momentum,

5
ğ‘£ğ‘–+ = ğ‘£ğ‘–âˆ’ cos 2ğ›¼ + âˆš2ğ‘¢ğ‘– sin 2ğ›¼ .

6

(2)

7
8

The single stance phase follows the step-to-step transition, and is modeled as an underactuated,

9

simple inverted pendulum. As a discrete measure of overall forward momentum, we use the mid-

10

stance velocity ğ‘£ğ‘– (no superscript; see Fig. 1e), sampled when the leg is vertical and the COM

11

velocity is purely forward.

12
13

We treat steady, level walking as the nominal condition (Fig. 1c). Each begins and ends at the

14

same speed ğ‘£ğ‘–âˆ’ = ğ‘£ğ‘–+ . The nominal push-off work ğ‘¢ğ‘– offsets the collision work14,

15

so that

16

1

ğ‘¢ğ‘– = 2 (ğ‘£ğ‘–âˆ’ )2 tan2 ğ›¼.

(3)

17
18

The up- or down-step disturbs steady walking (Fig. 1d). Its height ğ‘ (positive for up-steps,

19

negative for down-steps) causes the preceding step (ğ‘– = âˆ’1) to end with different leg angles

20

from nominal. For simplicity, we will typically refer to up-steps alone, and treat down-steps as a

21

straightforward generalization there-of, unless otherwise discussed. For a given height ğ‘ and step

22

length ğ‘†, we define the angular disturbance as ğ›¿ğ‘– ,

23
24

ğ‘

ğ›¿0 = sinâˆ’1 ğ‘† , ğ›¿ğ‘– = 0 for ğ‘– â‰  0 ,

(4)

25
26

where the angle is zero for all non-disturbance steps.

27
28

We expect that it is helpful to detect the up-step ahead of time, to allow push-off to occur pre-

29

emptively, that is, before the collision. Pre-emptive push-off is more economical both on the level
20

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

14

and on the up-step17, because it reduces the subsequent collision loss. If the up-step is

2

completely unanticipated, the push-off might occur late. If so, the leading leg collision first

3

redirects COM velocity along a new pendular arc. We refer to the work of a late push-off as ğ‘¢0+

4

(with the plus sign â€˜+â€™ indicating the post-collision timing), performed impulsively to increase

5

speed along that new arc:

6
7

Late push-off: ğ‘£0+ = âˆš(ğ‘£0âˆ’ cos 2ğ›¼)2 + 2ğ‘¢0+ for ğ‘– = 0 .

(5)

8
9

We treat the late push-off as of nominal amount, as if the nominal energy were stored elastically

10

as observed in humans30,31, but released late. The next step will then have substantially reduced

11

speed ğ‘£0+ and slower step time ğœ0 .

12
13

The inverted pendulum stance phase follows the step-to-step transition. The step time ğœğ‘– is

14

defined as the time for the stance leg angle ğœƒ to move from initial to final angles (ğ›¼ + ğ›¿ğ‘– and

15

âˆ’ğ›¼ + ğ›¿ğ‘–+1 , respectively). Using the linearized dynamics,

16
2

17

ğœğ‘– = log

2 âˆ’ğ›¿ 2
ğ›¼âˆ’ğ›¿ğ‘–+1 +âˆš(ğ‘£ğ‘–+ ) âˆ’2ğ›¼(ğ›¿ğ‘– +ğ›¿ğ‘–+1 )+ğ›¿ğ‘–+1
ğ‘–

ğ‘£ğ‘–+ âˆ’ğ›¼âˆ’ğ›¿ğ‘–

.

(6)

18
19

âˆ’
Solving the equation of motion with the step time, the velocity at end of stance ğ‘£ğ‘–+1
, or

20

equivalently the beginning of the next step-to-step transition can be found as:

21
22

1

âˆ’
ğ‘£ğ‘–+1
= 2 (ğ‘’ âˆ’ğœğ‘– (ğ‘£ğ‘–+ âˆ’ ğ›¼ âˆ’ ğ›¿ğ‘– ) + ğ‘’ ğœğ‘– (ğ‘£ğ‘–+ + ğ›¼ + ğ›¿ğ‘– )) .

(7)

23
24

We chose nominal parameters to correspond to typical human walking. A person with leg length

25

ğ¿ of 1 m may typically walk at 1.5 m/s, with step length of 0.79 m and step time of 0.53 s (from

26

anecdotal observations). Using dynamic similarity, parameters and results may be expressed in

27

terms of body mass ğ‘€, gravitational acceleration ğ‘”, and ğ¿ as base units. The corresponding

28

model parameters are angle ğ›¼ = 0.41, push-off ğ‘ˆ = 0.0342 ğ‘€ğ‘”ğ¿, step time ğ‘‡ = 1.66 ğ‘”âˆ’0.5 ğ¿0.5,
21

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

and pre-collision speed ğ‘‰ âˆ— = 0.601 ğ‘”0.5 ğ¿0.5, where capital letters indicate nominal values for ğ‘¢ğ‘– ,

2

ğœğ‘– , and ğ‘£ğ‘–âˆ’ , respectively. We also refer to a nominal speed ğ‘‰ = 0.44 ğ‘”0.5 ğ¿0.5 for mid-stance

3

speed ğ‘£ğ‘– . We considered a range of up-step heights, for example ğ‘ = 0.075ğ¿, equivalent to

4

about 7.5 cm for a human.

5
6

Although most of this study relied on the linearized dynamics of equations (6-7), we also

7

performed a subset of simulations with fully nonlinear dynamics to test the accuracy of this

8

approximation (Fig. 4).

9
10

Optimal Control Formulation

11

We used optimization to determine the push-off sequence that modulates momentum to most

12

economically negotiate a single disturbance. The objective was to minimize the total positive

13

work of ğ‘ consecutive push-offs of amount ğ‘¢ğ‘– , subject to constraints to depart from and then

14

regain nominal walking with no loss of time or speed compared to steady, level gait. The timing

15

of this compensation was found to affect overall economy and was therefore explored by shifting

16

the ğ‘ modulated steps earlier or later relative to the disturbance. The optimal strategies were

17

explored with parameter variations in compensatory steps ğ‘, step height ğ‘, nominal speed ğ‘‰,

18

and compensation timing ğ‘š.

19
20

The ğ‘ compensatory steps were nominally centered about the up-step. It is convenient to

21

consider odd ğ‘, so that the single up-step at ğ‘– = 0 is surrounded by an equal amount of

22

anticipatory steps before, and recovery steps after. The parameter ğ‘š (Fig. 1e) shifts these steps

23

later (ğ‘š > 0) or earlier (ğ‘š < 0). Again for odd ğ‘, the compensation steps range from â€œstartâ€ =

24

âˆ’

25

returns to nominal, level walking. The time constraint requires that the total time for stepping

26

onto and recovering from the uneven terrain, be equal to the nominal time to walk the same

27

number of level steps.

ğ‘âˆ’1
2

+ ğ‘š to â€œendâ€ =

ğ‘âˆ’1
2

+ ğ‘š. The speed constraint states that walking speed begins at and

28

22

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1

The optimal policy ğœ‹ (sequence of push-offs ğ‘¢start , â€¦ , ğ‘¢end , all constrained to be non-negative)

2

is:
end

ğœ‹ âˆ— = arg min âˆ‘ ğ‘¢ğ‘–
ğœ‹

(8)

ğ‘–=start

3
4

Subject to:

5
6

Initial speed:

âˆ’
ğ‘£start
= ğ‘‰âˆ—

Final speed:

+
ğ‘£end
= ğ‘‰âˆ—

Time:

âˆ‘end
ğ‘–=start ğœğ‘– = ğ‘ â‹… ğ‘‡

Dynamics:

Step-to-step transition equation (2)

7
8
9
10
11
12
13

Stance phase equation (6), equation (7)

14
15

We next define a persistence time for the hybrid dynamics of discrete step-to-step transitions

16

and continuous-time pendulum dynamics. On level ground and with unmodulated push-offs,

17

walking speed converges exponentially toward nominal with each discrete step. The step-to-step

18

eigenvalue cos 2ğ›¼ (about 0.68 for nominal gait; equation 2) determines this convergence. This

19

may be combined with the continuous-time step period ğ‘‡ to yield an overall decay with time

20

constant ğ‘‡persist :

21
Î”ğ‘£i+1

22

Î”ğ‘£ğ‘–

= cos 2ğ›¼ = ğ‘’

âˆ’

ğ‘‡
ğ‘‡persist

(9)

23
24

where Î”ğ‘£ğ‘– refers to the deviation from nominal mid-stance speed at step ğ‘–. Solving for

25

persistence time,

26

23

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

ğ‘‡persist = âˆ’ log

1

ğ‘‡
ğ‘’ cos 2ğ›¼

.

(10)

2
3

An analogous persistence distance may be found by dividing ğ‘‡persist by nominal speed.

4

Persistence time (or distance) may be interpreted as the time (or distance) required for a

5

disturbance response to decay to ğ‘’ âˆ’1 â‰ˆ 37% of its peak amplitude. It helps to place an

6

expectation on optimal recovery from a disturbance. With active control of push-off, it is of

7

course possible to change the disturbance response substantially. But when optimizing for work

8

or energy, we do not expect the response to be far faster than uncompensated, because that

9

would entail a high effort cost. Nor do we expect the response to be slower than the

10

uncompensated case, which is already stable. We therefore expect that optimal compensation

11

responses should be somewhat faster than uncompensated and should therefore decay within

12

no more than a few persistence times.

13
14

References

15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35

1. Hobbelen, D. G. E. & Wisse, M. A disturbance rejection measure for limit cycle walkers: The
gait sensitivity norm. IEEE Trans. Robot. 23, 1213â€“1224 (2007).
2. Park, H. W., Sreenath, K., Ramezani, A. & Grizzle, J. W. Switching control design for
accommodating large step-down disturbances in bipedal robot walking. in 2012 IEEE
International Conference on Robotics and Automation, ICRA 2012 45â€“50 (Institute of
Electrical and Electronics Engineers Inc., 2012). doi:10.1109/ICRA.2012.6225056.
3. Alexander, R. M. Energy-saving mechanisms in walking and running. J. Exp. Biol. 160, 55â€“69
(1991).
4. Kuo, A. D., Donelan, J. M. & Ruina, A. Energetic consequences of walking like an inverted
pendulum: step-to-step transitions. Exerc Sport Sci Rev 33, 88â€“97 (2005).
5. Byl, K. & Tedrake, R. Approximate optimal control of the compass gait on rough terrain. in
IEEE International Conference on Robotics and Automation, 2008, 1258â€“1263 (2008).
6. Manchester, I. R., Mettin, U., Iida, F. & Tedrake, R. Stable Dynamic Walking over Uneven
Terrain. Int J Rob Res 30, 265â€“279 (2011).
7. Saglam, C. O. & Byl, K. Quantifying and optimizing robustness of bipedal walking gaits on
rough terrain. in Robotics Research 235â€“251 (Springer, 2018).
8. Bhounsule, P. A., Cortell, J. & Ruina, A. Design and control of ranger: an energy-efficient,
dynamic walking robot. in Adaptive Mobile Robotics 441â€“448 (WORLD SCIENTIFIC, 2012).
doi:10.1142/9789814415958_0057.
9. Collins, S., Ruina, A., Tedrake, R. & Wisse, M. Efficient bipedal robots based on passivedynamic walkers. Science 307, 1082â€“1085 (2005).

24

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43

10. Manchester, I. R., Mettin, U., Iida, F. & Tedrake, R. Stable dynamic walking over rough
terrain: theory and experiment. in IN PROCEEDINGS OF THE INTERNATIONAL SYMPOSIUM
ON ROBOTICS RESEARCH (ISRR2009 (2009).
11. Westervelt, E. R., Grizzle, J. W. & Koditschek, D. E. Hybrid zero dynamics of planar biped
walkers. IEEE Trans. Autom. Control 48, 42â€“56 (2003).
12. Wisse, M. Three additions to passive dynamic walking: actuation, an upper body, and 3d
stability. Int J Humanoid Robot. 2, 459â€“478 (2005).
13. Garcia, M., Chatterjee, A., Ruina, A. & Coleman, M. The simplest walking model: Stability,
complexity, and scaling. ASME J. Biomech. Eng. 120, 281â€“288 (1998).
14. Kuo, A. D. Energetics of actively powered locomotion using the simplest walking model. J.
Biomech. Eng. 124, 113â€“20 (2002).
15. McGeer, T. Passive dynamic walking. Int. J. Robot. Res. 9, 62â€“82 (1990).
16. Donelan, J. M., Kram, R. & Kuo, A. D. Mechanical work for step-to-step transitions is a major
determinant of the metabolic cost of human walking. J. Exp. Biol. 205, 3717â€“27 (2002).
17. Darici, O., Temeltas, H. & Kuo, A. D. Optimal regulation of bipedal walking speed despite an
unexpected bump in the road. PLOS ONE 13, e0204205 (2018).
18. Mayne, D. Q. Model predictive control: Recent developments and future promise.
Automatica 50, 2967â€“2986 (2014).
19. Wieber, P. Trajectory Free Linear Model Predictive Control for Stable Walking in the
Presence of Strong Perturbations. in 2006 6th IEEE-RAS International Conference on
Humanoid Robots 137â€“142 (2006). doi:10.1109/ICHR.2006.321375.
20. Dimitrov, D., Wieber, P., Ferreau, H. J. & Diehl, M. On the implementation of model
predictive control for on-line walking pattern generation. in 2008 IEEE International
Conference on Robotics and Automation 2685â€“2690 (2008).
doi:10.1109/ROBOT.2008.4543617.
21. Farshidian, F., Jelavic, E., Satapathy, A., Giftthaler, M. & Buchli, J. Real-time motion planning
of legged robots: A model predictive control approach. in 2017 IEEE-RAS 17th International
Conference on Humanoid Robotics (Humanoids) 577â€“584 (2017).
doi:10.1109/HUMANOIDS.2017.8246930.
22. Posa, M., Kuindersma, S. & Tedrake, R. Optimization and stabilization of trajectories for
constrained dynamical systems. in 2016 IEEE International Conference on Robotics and
Automation (ICRA) 1366â€“1373 (2016). doi:10.1109/ICRA.2016.7487270.
23. Darici, O., Temeltas, H. & Kuo, A. D. Anticipatory speed changes for optimal human walking
on uneven terrain. in XXVI Congress of the International Society of Biomechanics (2017).
24. Matthis, J. S. & Fajen, B. R. Humans exploit the biomechanics of bipedal gait during visually
guided walking over complex terrain. Proc. Biol. Sci. 280, 20130700 (2013).
25. Wu, A. R. & Kuo, A. D. Determinants of preferred ground clearance during swing phase of
human walking. J. Exp. Biol. jeb.137356 (2016) doi:10.1242/jeb.137356.
26. Seethapathi, N. & Srinivasan, M. The metabolic cost of changing walking speeds is
significant, implies lower optimal speeds for shorter distances, and increases daily energy
estimates. Biol. Lett. 11, 20150486 (2015).
27. Grizzle, J. W., Chevallereau, C., Sinnet, R. W. & Ames, A. D. Models, feedback control, and
open problems of 3D bipedal robotic walking. Automatica 50, 1955â€“1988 (2014).

25

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1
2
3
4
5
6
7
8
9
10

28. Rebula, J. R., Ojeda, L. V., Adamczyk, P. G. & Kuo, A. D. The stabilizing properties of foot yaw
in human walking. J. Biomech. 53, 1â€“8 (2017).
29. Geyer, H., Seyfarth, A. & Blickhan, R. Compliant leg behaviour explains basic dynamics of
walking and running. Proc. R. Soc. B-Biol. Sci. 273, 2861â€“2867 (2006).
30. Fukunaga, T. et al. In vivo behaviour of human muscle tendon during walking. Proc. Biol. Sci.
268, 229â€“233 (2001).
31. Zelik, K. E., Huang, T.-W. P., Adamczyk, P. G. & Kuo, A. D. The role of series ankle elasticity in
bipedal walking. J. Theor. Biol. 346, 75â€“85 (2014).

11

This work is supported by NSF DGE 0718128, the ONR ETOWL program, NIH AG030815, the Dr.

12

Benno Nigg Research Chair (University of Calgary), and NSERC (Natural Sciences and Engineering

13

Research Council of Canada) Discovery program and Canada Research Chair (Tier 1) program.

Acknowledgements

14
15

Author Contributions

16

O.D. performed the simulations and generated the figures. O.D. and A.D.K. wrote the manuscript.

17

A.D.K. also revised the manuscript and the figures. H.T. reviewed the manuscript.

18
19

Additional Information

20

Competing Interests: The authors declare no competing interests.

21
22

Figure Legends

23

Figure 1. Simple model of walking over a single up- (or down-) step. (a) Body center of mass (COM) is a point mass

24

carried atop stance leg acting as an inverted pendulum, encountering step of height ğ‘. (b) Model has mass ğ‘€ at

25

pelvis, with massless legs of length ğ¿, gravitational acceleration ğ‘”, and a fixed step length ğ‘†, also described by inter-

26

leg angle 2ğ›¼. Stance leg angle is measured with angle ğœƒ as shown. (c) Level nominal step-to-step transition, where

27

COM velocity is redirected from forward-and-downward ğ‘£ğ‘–âˆ’ to forward-and-upward ğ‘£ğ‘–+ , first with active, impulsive

28

trailing leg push-off (PO), followed by inelastic, impulsive, leading leg collision (CO). (d) The up-step occurs on step

29

ğ‘– = 0, with two cases: pre-emptive and late push-off, which both perform positive work (ğ‘¢0 and ğ‘¢0+ , respectively)

30

but earlier or later than collision. (e) Optimization is performed to modulate ğ‘ push-offs to minimize their total work

31

while accommodating the up-step and taking the same time as nominal, level walking at speed ğ‘‰. The ğ‘ steps are

32

nominally centered on the up-step for equal anticipation and recovery. We also consider cases where the

33

compensatory steps are shifted by ğ‘š steps relative to obstacle. Up-steps are denoted by ğ‘ > 0; down-steps by ğ‘ <

34

0.

26

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1
2

Figure 2. Effect of an uncompensated up-step. (a) Speed fluctuations vs. time, for an up-step at time 0 with constant

3

push-off. Model experiences transient disturbance from nominal speed due to up-step, with smaller effect if push-

4

off occurs pre-emptively as opposed to late. Each dot (filled symbol) indicates a discrete step, with speed v_i sampled

5

at mid-stance (see Fig. 1e). (b) Cumulative time gain vs. time shows accumulating effect of speed loss, with

6

asymptote towards a total time loss (negative time gain). (c) Total time gain vs. up-step height ğ‘ for various nominal

7

walking speeds, with greater bumps causing greater loss of time, and smaller effect for faster nominal speeds. Also

8

shown are effects of late push-off (unfilled symbols). Up-step height ğ‘ = 0.025ğ¿, nominal mid-stance velocity ğ‘‰ =

9

0.44ğ‘”âˆ’0.5 ğ¿0.5 . Conditions are equivalent to a human walking at 1.5 m/s, encountering an up-step of 2.5 cm.

10
11

Figure 3. Optimal strategies to gain time during level walking, separate from any disturbance, for (top row:) varying

12

amounts of time ğ‘¡gain , and (bottom row:) varying number of steps ğ‘. Each row, from left to right: Speed fluctuations

13

vs. time, push-off work vs. time, and cumulative time gain vs. time, relative to nominal (each step denoted by filled

14

symbol). Parameter values are ğ‘ = 9 steps for top row, ğ‘¡gain = 0.5 for bottom row. Filled dot symbols indicate

15

steps. Unfilled symbols denote large push-offs that entail momentary aerial phases or even running for several steps;

16

maximum time gain thresholds to avoid such cases are shown in (top most right).

17
18

Figure 4. Optimal strategies to compensate for an up-step, for (top row) varying number of steps ğ‘, and (bottom

19

row) varying step height ğ‘. Each row, from left to right: Speed ğ‘£ğ‘– vs. time, push-off work vs. time, and cumulative

20

time gain vs. time. In top row, step height is fixed (ğ‘ = 0.075ğ¿), and optimal solutions shown are for linearized

21

model, superimposed on nonlinear model solutions (dashed lines). In bottom row, both up- and down-step (positive

22

and negative ğ‘, respectively) solutions are shown for linearized model; ğ‘ = 9. Optimal strategies are all centered

23

about the up-step (ğ‘š = 0).

24
25

Figure 5. Costs for optimal compensation strategies, as a function of compensation timing (shifting by ğ‘š relative to

26

up-step, see Fig. 1) and the number of compensation steps (ğ‘). (a) Total extra work vs. ğ‘š, for ğ‘ compensatory steps

27

(ğ‘ = 9, ğ‘ = 0.075ğ¿). Total extra work is defined as the work in excess of ğ‘ nominal steps. Filled symbols indicate

28

cost for each ğ‘š, lighter horizontal lines indicate compensation range of ğ‘ steps. (b) Peak push-off work vs. ğ‘š. (c)

29

Total extra work vs. ğ‘, and (d) Peak push-off work vs. ğ‘ for optimal compensation centered about up-step (ğ‘š = 0).

30

Also shown is the cost of an isolated time gain from nominal walking (Fig. 3), to regain time lost from an equivalent

31

up-step (ğ‘ = 0.075ğ¿, ğ‘¡gain = 2.48 ğ‘”âˆ’0.5 ğ¿0.5 ) with no compensation. In (a) and (b), minima for both total and peak

32

work occur at ğ‘š = 0, where compensatory steps are distributed equally before and after the disturbance. Both costs

33

also decrease for greater ğ‘. Also shown in (a) is the optimal strategy for recovering from an unanticipated up-step

34

with a late push-off on the up-step.

27

bioRxiv preprint doi: https://doi.org/10.1101/769828; this version posted December 6, 2019. The copyright holder for this preprint (which was
not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available
under aCC-BY-NC-ND 4.0 International license.

Darici et. al., Anticipatory control for bipedal walking on uneven terrain

1
2

Figure 6. Effect of parameter variations on optimal strategies. (a) Optimal speed fluctuations for varying step length

3

(via leg angle ğ›¼; constant average speed). (b) Optimal speed fluctuations for varying speed (via step frequency;

4

constant leg angle ğ›¼). In both (a) and (b), ğ‘ = 0.075ğ¿ and ğ‘ = 9. (c) Speed fluctuations for all parameter variations

5

considered thus far, scaled by persistence time. Superimposed are variations in number of steps ğ‘ (Fig. 4 top), step

6

height ğ‘ (Fig. 4 bottom), step length, and speed. All amplitudes are plotted relative to respective nominal speed, and

7

have been normalized to unity positive peak. Speed fluctuations for negative step heights are shown negated to

8

facilitate comparison.

28

