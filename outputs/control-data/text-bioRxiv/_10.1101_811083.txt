bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Liquid-like and rigid-body motions in moleculardynamics simulations of a crystalline protein
David C. Wych1,2, James S. Fraser3, David L. Mobley1,4, Michael E. Wall2,*
1

Department of Pharmaceutical Sciences, University of California, Irvine, Irvine, CA, USA
Computer, Computational, and Statistical Sciences Division, Los Alamos National Laboratory,
Los Alamos, NM, USA
3
Department of Bioengineering and Therapeutic Sciences, University of California, San Francisco,
San Francisco, CA, USA
4
Department of Chemistry, University of California, Irvine, Irvine, CA, USA
2

Los Alamos National Laboratory LA-UR-19-30460
Abbreviations: molecular dynamics (MD); liquid-like motions (LLM); rigid-body motions
(RBM); thymidine-3‚Ä≤-5‚Ä≤-bisphosphate (pdTp)
Key words: liquid-like motions; rigid-body motions; molecular-dynamics simulation; protein
crystallography; protein dynamics; diffuse scattering
*Corresponding author: mewall@lanl.gov

Abstract
To gain insight into crystalline protein dynamics, we performed molecular-dynamics (MD)
simulations of a periodic 2x2x2 supercell of staphylococcal nuclease. We used the resulting MD
trajectories to simulate X-ray diffraction and to study collective motions. The agreement of
simulated X-ray diffraction with the data is comparable to previous MD simulation studies. We
studied collective motions by analyzing statistically the covariance of alpha-carbon position
displacements. The covariance decreases exponentially with the distance between atoms, which is
consistent with a liquid-like motions (LLM) model, in which the protein behaves like a soft
material. To gain finer insight into the collective motions, we examined the covariance behavior
within a protein molecule (intra-protein) and between different protein molecules (inter-protein).
The inter-protein atom pairs, which dominate the overall statistics, exhibit LLM behavior;
however, the intra-protein pairs exhibit behavior that is consistent with a superposition of LLM
and rigid-body motions (RBM). Our results indicate that LLM behavior of global dynamics is
present in MD simulations of a protein crystal. They also show that RBM behavior is detectable
in the simulations but that it is subsumed by the LLM behavior. Finally the results provide clues
about how correlated motions of atom pairs both within and across proteins might manifest in
diffraction data. Overall our findings increase our understanding of the connection between
molecular motions and diffraction data, and therefore advance efforts to extract information about
functionally important motions from crystallography experiments.

1

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Introduction
Macromolecular crystals consist of many copies of a large molecule (or molecules) packed into a
lattice of repeating units. Crystals are often illustrated using identical repeating units; however, in
real crystals, each copy of a molecule can adopt a somewhat different structure as long as overall
order is maintained. Although structural variations occur in small-molecule crystals1, the problem
of conformational heterogeneity is especially important for macromolecular crystals, which have
many more degrees of freedom and high solvent content.2 3 Understanding the structural variations
in crystals can potentially be used for increasing the accuracy of crystal structure models4 and for
developing crystallography as a tool for characterizing conformational heterogeneity and
dynamics in structural biology.5
In X-ray crystallography (and similarly for neutron and electron crystallography), the
details of the molecules‚Äô conformations and their packing in the crystal lattice leave signatures in
the diffraction pattern. Most of our current understanding of conformational variation in crystals
comes from analysis of Bragg reflections, which are the sharp peaks in the diffraction pattern. The
Bragg peaks are traditionally modeled using an average picture of the repeating unit, or unit cell,
which contains the mean electron density over all unit cells illuminated by the beam. The most
common model multiplies each atomic form factor by an atomic displacement parameter (also
known as a Debye-Waller factor, B-factor, or thermal factor) corresponding to a 3D Gaussian
distribution of each atom‚Äôs displacements.
Modern Bragg analysis methods are producing richer descriptions of conformational
variations. For example, anisotropic displacements of groups of atoms can be modeled with a small
number of parameters using the Translation Libration Screw (TLS) model,6 which can be used as
a supplement or substitute to refining individual atomic displacement parameters.7 More elaborate
models of conformational heterogeneity can also be employed,8 including incorporating local
alternative conformations in multiconformer models9 10 or generating multiple models using
hybrid molecular dynamics ensemble refinement that collectively satisfy the data.10 These models
can imply distinct collective motions that would leave signatures in the spatial correlations of
electron density variations. Therefore, even if more elaborate model of motion improve agreement
with the Bragg data, they would need to be validated to determine whether they describe what is
actually happening in the crystal.11 Indeed, distinct TLS refinements with different implied
collective motions can yield equivalent agreement with the Bragg data.12
The degeneracy of models with respect to the mean electron density fortunately does not
extend to spatial correlations in electron density variations. Models with different correlations lead
to distinct patterns of diffuse scattering that appear as intensity underneath and between the Bragg
peaks in diffraction images. Recent years have seen a renaissance in methods for processing and
modeling diffuse scattering.3 2 13 However, studies of diffuse scattering have differed in their
conclusions, both about the degree to which the signal can be explained by various models of
correlated motion, and about the importance of different types of motion in determining the
conformational variations in protein crystals.14 15 16 2 17 Some studies find evidence for liquid-like
motions (LLM), which models the crystal contents as a soft material with correlated displacements
on a characteristic length scale.18 Others find evidence for rigid-body motions (RBM),15 which
could, in principle, be modeled by descriptions such as TLS models.12 Ensemble models, in which
a limited set of representative structures are selected from a full conformational distribution,19 also
have been studied, and found lacking.14 15 A potential problem with ensemble models is that they
exhibit exaggerated correlations due to the absence of finer-scale structure variations.20 More

2

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

sophisticated models might be able to better capture the correlated motions within the crystal.21
Considering the true crystalline context by including neighboring unit cells in the calculations can
increase agreement of simple models like LLM.14
Whereas each of the above mentioned models of diffuse scattering explicitly represents
only a subset of the possible structural variations, molecular-dynamics (MD) simulations of
crystalline proteins provide an all-atom picture of a wide variety of available motions.22 23 24 25
Early MD simulations of diffuse scattering were hindered by the short duration (< 1 ns) which
resulted in limited sampling of the conformational ensemble, and calculations that were not
reproducible across different runs.26 Agreement between experimental and predicted diffuse
scattering of crystalline staphylococcal nuclease increased as the simulation duration increased to
10 ns27 and then even more as it was increased to 1 microsecond.25 A recent simulation of
staphylococcal nuclease extended the simulation volume from a single periodic unit cell to a 2x2x2
supercell, leading to further increases in the agreement with the experimental data.28 This result
parallels the emerging theme from the LLM work,14 which highlighted the importance of
considering more than just a single unit cell to generate strong agreement with experimental data.29
MD provides a full description of all atoms in the system, but has a high computational cost relative
to the simpler models, such as LLM and RBM. Because simpler models can potentially be
incorporated into joint X-ray Bragg and diffuse scattering model refinement, it is interesting to
investigate the degree to which the motions described by simpler models, such as the LLM and
RBM models, appear in the increasingly accurate MD simulations that are now achievable. It is
worth noting that while the LLM and RBM models include parameters explicitly fit to match
diffuse scattering patterns, MD models utilize no such fit, making this comparison particularly
interesting.
Here we assess the degree to which LLM and RBM behaviors are present in MD
simulations of crystalline staphylococcal nuclease. We performed new MD simulations of
crystalline staphyloccocal nuclease and confirmed their agreement with diffuse scattering data is
similar to previous studies. We then computed covariance matrices of atom displacements from
the resulting MD trajectories, and analyzed the dependence of the covariance on the average
separation between atoms which are covarying. The covariance behavior is well fit by an
exponential decrease with distance, supporting a LLM model. However, when the analysis is
restricted to atom pairs that lie within the same protein, the behavior is consistent with a
combination of LLM and RBM. Comparison of results obtained using AMBER vs CHARMM
force fields reveal some differences in the simulations and covariance behavior. Our results
indicate that LLM behavior of global dynamics emerges from MD simulations of a protein crystal.
They also show that RBM behavior is detectable in the simulations but that it is subsumed by the
LLM behavior when adding atom pairs that cross protein boundaries. Finally they provide clues
about how correlated motions of atom pairs both within and across proteins might manifest in the
diffuse scattering data. Overall our findings increase our understanding of the connection between
molecular motions and diffuse scattering data, and therefore advance efforts to extract information
about functionally important motions from crystallography experiments.

3

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Figure 1. Illustration of the model used for molecular dynamics simulations. There are 32 copies of the protein
rendered using ribbons in a periodic box of 2x2x2 unit cells. The yellow arrow indicates an atom pair that lies entirely
within the blue protein, pointing from residue 61 to residue 131 (corresponding to the ‚Äúwithin‚Äù or ‚Äúintra-protein‚Äù
analysis). The cyan arrow indicates an atom pair that spans across proteins, pointing from residue 131 in the magenta
to residue 128 in the green protein (corresponding to the ‚Äúacross‚Äù or ‚Äúinter-protein‚Äù analysis). Water molecules are
rendered in light, transparent blue, giving the appearance of connected droplets. The image was created using UCSF
Chimera.30

Results
Molecular dynamics simulations
In this study we sought to investigate the connection between MD simulations and other, less
detailed models of crystalline dynamics, like the LLM model. For the MD simulations, we used a
model of crystalline staphylococcal nuclease, consisting of a periodic box consisting of 2x2x2 unit
cells (Fig. 1; Methods). Solution state simulations commonly are performed using a NPT
ensemble; however, as we wished to compare our simulations to diffraction data, we used a NVT
ensemble, maintaining the consistency of the system with the experimentally determined Bragg
lattice during the course of the simulation. To determine the sensitivity of the results to the force
field, we used both AMBER 14SB and CHARMM 27 force fields in GROMACS.
4

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Consistent with previous studies,28 25 which used similar methods to the present study, after
initial solvation and minimization, during the first equilibration step, the pressure of the systems
was large and negative: -1439 +/- 39 bar for the AMBER simulation, and -1795 +/- 252 bar for the
CHARMM simulation (as reported by gmx energy). To bring the system to atmospheric pressure,
additional water molecules were added iteratively, with intervening rounds of NVT equilibration,
until the mean system pressure was in the range of -100 to 100 bar (Methods). The number of
water molecules added was roughly the same for both systems (17,557 waters for AMBER and
17,138 waters for CHARMM).
After the iterative solvation steps, unrestrained MD simulations were carried out for 600
ns. The potential energy drifted during the first ~100 ns the simulation, after restraints were
released, and remained relatively stable thereafter. To ensure that the drift did not influence the
results of our analysis of the trajectory, the initial 200 ns section was ignored, and only the last 400
ns section was analyzed. The B-factors predicted by the atomic fluctuations (not shown) were
consistent with previous studies of the same system 28, and with the experimentally determined B
factors.

Figure 2. Simulated diffraction images derived from MD simulations and 3D experimental diffuse data. 2x2x2
sampling. The images are truncated at 1.8 ‚Ñ´. To make the anisotropic features more visible, the 3D diffuse intensities
have had the minimum intensity value subtracted in constant resolution shells prior to generating these images. Left.
Image derived from AMBER force-field simulation. Center. Image derived from experimental data. Right. Image
derived from CHARMM force-field simulation. The diffuse intensity for MD simulations was accumulated
incoherently across 100 ns sections of the trajectory in the time range 200 - 600 ns after relaxing restraints. Both the
AMBER and CHARMM MD simulations show similar diffuse features to those in the experimentally derived images,
e.g., the strong intensity in the ring and cloudy features at higher resolution. The images were displayed using the heat
map mode of ADXV.31

Simulated diffuse intensity
To determine the agreement of the simulations with diffuse scattering data, we computed diffuse
intensities from MD trajectories and computed the Pearson correlation coefficient between the
simulated and experimental intensities (Methods). Simulated diffuse diffraction images computed
from the MD simulations and experimental data are compared in Fig. 2. The Pearson correlation
between the simulated and experimental total 3D diffuse intensities was 0.9 or higher for all
simulations, similar to that found in a previous study utilizing the same approach.28 The correlation
of the anisotropic component of the intensity, computed by subtracting an interpolated radial
average,28 was 0.58 (AMBER) and 0.63 (CHARMM) for the anisotropic intensity, which is lower

5

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

than the value of 0.68 previously reported in Ref. 28. We re-analyzed the data in Ref. 28 and
obtained the same correlation of 0.68, confirming that the difference is attributed to the simulations
rather than the analysis workflow.
To gain finer-grained insight into the agreement between the simulated and experimental
diffuse intensities, we analyzed the trajectory in 100 ns sections (Supplementary Fig. S1). The
correlation computed using each section is between 0.53 and 0.58 which is lower than the 0.58 and
0.63 values obtained using the diffuse intensity accumulated for 400 ns. The cumulative agreement
also is sensitive to whether the diffuse intensity is accumulated coherently or incoherently across
the individual 100 ns sections (see Methods for definition of coherent vs incoherent accumulation):
when accumulated coherently, the correlation is 0.54 (AMBER) 0.58 (CHARMM) which is lower
than the values 0.58 (AMBER) and 0.62 (CHARMM) when accumulated incoherently.

Liquid-like motions behavior of all CŒ± atom pairs
To assess whether the MD simulations produced behavior that is consistent with the LLM model,
we computed atom displacement covariance matrices (Methods). The covariance matrices are
needed because the key assumption of the LLM model is that the covariance matrix elements
connecting any two atoms i and j in the crystal are simply proportional to ùëí "#$%‚ÅÑ& , where rij is the
distance between the atoms, and g is the characteristic length scale of the correlations.18 To make
the calculations and analysis manageable computationally and to obtain a coarse-grained picture
of the covariance, we restricted the analysis to CŒ± atoms.
The full covariance matrix of CŒ± displacements for our system is a 14,304 x 14,304 square
matrix with each row or column corresponding to one of three cartesian coordinates of each of 149
CŒ± atoms in each of 32 proteins in the model. To perform our analyses, we replaced the 3x3
submatrix for each atom pair with its trace, leaving a 4,768 x 4,768 square symmetric matrix. In
this form, the diagonal elements correspond to the mean squared deviation (MSD) for each atom,
and the off-diagonal elements correspond to the trace of the covariance of the displacements of
each atom pair. The full covariance matrix contains regions of both positive and negative
covariance, with the strongest positive values being in blocks about the diagonal (Supplementary
Fig. S2), corresponding to atom pairs that fall within a protein (as connected by the yellow line in
Fig. 1).
To determine the dependence of the matrix elements coupling atoms i and j on the distance
between the atoms rij, we computed the distance between each of the atom pairs and divided the
distance range into 50 even bins. We then calculated the mean and standard error of the covariance
within each of the bins (Methods). For each simulation, at the lowest distance there is a single bin
with high covariance compared to the other bins: in the AMBER case, a point at 1.67 ‚Ñ´ with
covariance 15.5 ‚Ñ´2 +/- 1.84 ‚Ñ´2 as it is out of range in y; in the CHARMM case, a point at 1.47 ‚Ñ´
with covariance 21.8 ‚Ñ´2 +/- 3.06 ‚Ñ´2 is not shown, as it is out of range in y. Beyond 5 ‚Ñ´ (Fig. 3)
the covariance is much lower (20-fold lower than in the nearest bin below) and shows a more
gradual decrease with distance, falling from a value of 0.30 ‚Ñ´2 at 5 ‚Ñ´, crossing below zero beyond
about 40 ‚Ñ´ to a minimum value of either -0.02 (AMBER) or -0.03 (CHARMM) ‚Ñ´2 beyond about
50 ‚Ñ´, and rising to a value closer to zero beyond about 80 ‚Ñ´ (AMBER) or 60 ‚Ñ´ (CHARMM).

6

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Figure 3. Dependence of covariance on distance for all CŒ± atom pairs. Mean values of covariance +/- standard errors
are shown using vertically oriented error bars. Exponential fits to the values in the 5-55.5 ‚Ñ´ range are shown using
dashed lines. The upper y-range is truncated at 1 ‚Ñ´2, showing the full range of the exponential fit but excluding one
high covariance value at very short distance from each panel. Left. AMBER force field. The exponential fit has a
decay length of 11.0 ‚Ñ´. Right. CHARMM force field. The exponential fit has a decay length of 11.1 ‚Ñ´.

To assess whether these plots display exponential decay behavior, the values of the
covariance ùê∂(ùëü) were fit to the function ùê∂(ùëü) = ùëéùëí "#/& + ùëè, where ùëü is the distance between
atoms, in the range r between 5 ‚Ñ´ and 55.5 ‚Ñ´ . (We found the exponential fit was poor without
adding the constant ùëè, so we added it.) For the AMBER simulation, the fit yielded a = 0.79 ¬± 0.01
‚Ñ´2, Œ≥ = 11.0 ¬± 0.1 ‚Ñ´, and b = -0.022 ¬± 0.001 ‚Ñ´2. For the CHARMM simulation, the fit yielded a
= 0.94 ¬± 0.02 ‚Ñ´2, Œ≥ = 11.1 ¬± 0.2 ‚Ñ´, and b = -0.029 ¬± 0.001 ‚Ñ´2. The constant offset at long distances
is consistent with an earlier simulation,27 which postulated that it might be an artifact of
translational alignment of the MD trajectory snapshots ‚Äì a necessary step before computing the
covariance matrix (Methods). Fig. 3 shows that the fit overlaps the computed covariances in the
region below 60 ‚Ñ´, and therefore displays exponential decay behavior, which is consistent with
the assumption of the LLM.

Figure 4. Dependence of covariance on distance for just inter-protein CŒ± atom pairs. Mean values of covariance +/standard errors are shown using vertically oriented error bars. Exponential fits to the values in the 5-55.5 ‚Ñ´ range are
shown using dashed lines. The upper y-range is truncated at 0.6 ‚Ñ´2. Left. AMBER force field. The shortest distance
point is not shown as it is out of range. The exponential fit has a decay length of 14.3 ¬± 0.4 ‚Ñ´. Right. CHARMM force
field. The exponential fit has a decay length of 13.4 ¬± 0.3 ‚Ñ´. The exponential fits are fairly good, but not as good as
in Figs. 3.

7

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Combination of liquid-like and rigid-body motions behaviors within proteins
As noted in the previous section, the strongest positive values of the covariance matrix were in
blocks along the diagonal (Supplementary Fig. S2). These blocks correspond to CŒ± atom pairs that
lie within the same protein (yellow line in Fig. 1), which we refer to as ‚Äúintra-protein‚Äù or ‚Äúwithinprotein‚Äù atom pairs. The rest of the covariance matrix corresponds to atom pairs that cross protein
boundaries, which we refer to as ‚Äúinter-protein‚Äù or ‚Äúacross-protein‚Äù atom pairs (cyan line in Fig.
1). (The subsets of intra-protein and inter-protein CŒ± atom pairs are complementary with respect
to the set of all CŒ± atom pairs.) We wondered whether the LLM behavior observed for all CŒ± atom
pairs also would apply individually to these subsets. We therefore computed the covariance vs
distance for each. We also wished to focus our attention on the more stable region of the protein
and therefore eliminated residues at the extreme N- and C-terminal CŒ± atoms from our calculations
(Methods).
The shape of the curve for inter-protein atom pairs (Fig. 4) is similar to that for all CŒ± atom
pairs (Fig. 3). In the case of the AMBER simulation, a point at 3.3 ‚Ñ´ with covariance -1.77 ‚Ñ´2 +/1.23 ‚Ñ´2 is not shown as it is out of range in y. For AMBER the best-fit exponential decay has a =
0.42 ¬± 0.02 ‚Ñ´2, Œ≥ = 14.3 ¬± 0.4 ‚Ñ´, and b = 0.025 ¬± 0.001 ‚Ñ´2; for CHARMM the best-fit has a =
0.55 ¬± 0.02 ‚Ñ´2, Œ≥ = 13.4 ¬± 0.3 ‚Ñ´, and b = 0.032 ¬± 0.001 ‚Ñ´2. The values at short distance are smaller
in the inter-protein analysis than in the analysis of all atom pairs. In the case of the AMBER
simulation, the exponential fit deviates from the covariance values in the region below 10 ‚Ñ´ (Fig.
4). The values of a are smaller than for all atom pairs, supporting the observation that the values
at short distance are smaller. The values of Œ≥ are larger than for all atom pairs, indicating that
correlations extend to a longer length scale. The values of b are similar to the values for all atom
pairs.

Figure 5. Dependence of covariance on distance for only intra-protein CŒ± atom pairs. Mean values of covariance +/standard errors from the MD simulations are shown using vertically oriented error bars. Values computed from RBM
models are shown using dashed lines (standard errors are O(10-5) ‚Ñ´2 and are therefore not shown). The upper y-range
is truncated at 0.6 ‚Ñ´2, showing the full range of the exponential fit but excluding one high covariance value at the
shortest distance from the MD values in each panel. Left. AMBER force field. The RBM model has a width (SD)
0.95 degrees for the angular distribution and 0.24 ‚Ñ´ for the translational distribution. Right. CHARMM force field.
The RBM model has a width (SD) 1.05 degrees for the angular distribution and 0.27 ‚Ñ´ for the translational distribution.
The MD simulations are well modelled using rigid-body translations and rotations for distances greater than 20 ‚Ñ´.

In contrast with the inter-protein atom pairs, the shape of the curve for atom pairs within
proteins (Fig. 5) is very different (note that the x-axis only extends to ~42.5 ‚Ñ´, while retaining the

8

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

number of bins at 50). In the AMBER case, a MD point at 2.90 ‚Ñ´ with covariance 1.64 ‚Ñ´2 +/- 0.38
‚Ñ´2 is not shown as it is out of range in y. In the case of the CHARMM simulation, A MD point
at 3.2 ‚Ñ´ with covariance 2.85 ‚Ñ´2 +/- 0.23 ‚Ñ´2 is not shown as it is out of range in y. The values still
decrease with increasing distance, but the curvature is lower near 5 ‚Ñ´. Moreover the behavior is
almost linear above 20 ‚Ñ´, crossing zero at about 38 ‚Ñ´, and decreasing to about -0.05 ‚Ñ´2 at the
longest distance.
In seeking an explanation for the linear behavior, we reasoned that rigid-body rotations of
individual proteins should give rise to a decreasing covariance with distance. For example, during
a rotation through the center of mass, nearby atoms on the surface would tend to move together,
giving rise to a positive covariance, and atoms at remote locations on the surface would tend to
move in opposite directions, giving rise to a negative covariance. We postulated that this might
lead to a decreasing covariance with distance that is positive at short distances and becomes
negative at long distances. Adding a rigid-body translation after the rotation would lead to a
uniform positive covariance within the protein, shifting the curve up and the zero crossing to longer
distances.
To test this idea, we generated an ensemble of snapshots displaying varying degrees of
RBM. For each snapshot, three Euler angles and a translational shift were drawn from a normal
distribution, and rigid coordinate transformations were applied to a single staphylococcal nuclease
protein from the MD model. The widths of the distributions were chosen to be on par with the
magnitude of motion observed in our MD simulations. The covariance matrix was computed from
the snapshots, and the distance dependence was analyzed in the same manner as for the MD
trajectories.
We adjusted the standard deviation (SD) of the angular and translational distributions to
optimize the visual agreement with the MD simulation in the long-distance part of the curve. In
the case of the AMBER simulation, the final SD used for the angular distribution was 0.95 degrees,
and the SD of the translational distribution was 0.24 ‚Ñ´. For the CHARMM simulation, the SD of
the angular distribution was 1.05 degrees, and the SD of the translational distribution was 0.27 ‚Ñ´.
The model tracks MD simulation results in the region above about 20 ‚Ñ´ (Fig. 4), indicating that
the MD covariance in this long-distance region is consistent with RBM.
To explain the behavior in the region below 20 ‚Ñ´, we subtracted the RBM plots from the
corresponding MD simulation plots in Fig. 5, yielding the residual shown in Fig. 6. In the AMBER
case, a point at 2.9 ‚Ñ´ with covariance 1.31 ‚Ñ´2 is not shown as it is out of range in y. In the
CHARMM case, a MD point at 3.2 ‚Ñ´ with covariance 2.45 ‚Ñ´2 is not shown as it is out of range in
y. As the residual plots resemble an exponential decay, we again fit them to the function ùê∂(ùëü) =
ùëéùëí "#/& + ùëè in the region r > 5 ‚Ñ´. For the AMBER simulation, the fit yielded a = 0.37 ¬± 0.02 ‚Ñ´2,
Œ≥ = 5.7 ¬± 0.2 ‚Ñ´, b = 0 ‚Ñ´2 to within error; for CHARMM, the fit yielded a = 0.46 ¬± 0.03 ‚Ñ´2, Œ≥ = 5.7
¬± 0.3 ‚Ñ´, and b = -0.002 ¬± 0.001 ‚Ñ´2. The fit confirms that the residual is consistent with an
exponential decay, but with a much shorter length scale than for the inter-protein atom pairs.
Additional insight into the LLM behavior comes from comparing the values of Œ≥ and a
obtained from the MD analysis with the values obtained by fitting a LLM model to coarsely
sampled (one point per Miller index) experimental diffuse scattering data (Methods). The refined
LLM model had a Pearson correlation coefficient with the anisotropic data of 0.73, with Œ≥ = 6.5 ‚Ñ´
and s = 0.41 ‚Ñ´ (the agreement with the total diffuse data, as opposed to the anisotropic data, is
poor, as the LLM model does not include solvent). A comparison of simulated diffraction images
from the model and data is shown in Supplementary Fig. S4. The value of Œ≥ is closer to the value
for the intra-protein analysis (5.5 ‚Ñ´) than for the inter-protein (11.5 ‚Ñ´) or all-atom (12 ‚Ñ´) analysis.

9

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

The value of s corresponds to a MSD of 3 √ó (0.41 ‚Ñ´)2 = 0.50 ‚Ñ´2 which is comparable to the values
obtained in the intra-protein analysis (0.42 ‚Ñ´2 for AMBER and 0.48 ‚Ñ´2 for CHARMM) and to the
values for the inter-protein analysis (0.55 ‚Ñ´2 for AMBER and 0.66 ‚Ñ´2 for CHARMM). This
comparison indicates that the coarsely sampled diffuse scattering data exhibit both a length scale
of correlations and amplitude of motion that are most consistent with the intra-protein atom pairs
in the MD simulation (see Discussion).

Figure 6. Residual covariance computed from the MD simulations, after subtracting the covariance values of the RBM
model (see Fig. 5). Mean values of covariance +/- standard errors from the MD simulations are shown using vertically
oriented error bars. Exponential fits to the values in the range above 5 ‚Ñ´ are shown using dashed lines. The upper yrange is truncated at 0.5 ‚Ñ´2, showing the full range of the exponential fit but excluding one high covariance value at
the shortest distance from each panel. Left. AMBER force field. Right. CHARMM force field. Both residuals are well
fit by an exponential with the same decay length of 5.7 ‚Ñ´.

Discussion
Our crystalline MD simulations of staphylococcal nuclease reveal a consistency with the LLM
model: the distance dependence of the covariance of CŒ± displacements follows an exponential
decay. This finding indicates that LLM behavior is present in a more realistic, highly detailed, allatom description of the dynamics. It also provides a rationale for why the LLM model, which uses
only a few parameters, can provide a reasonable explanation of diffuse scattering data, which
depends on the atomic details of the structure variations.
The atomic details contained in the MD also allow us to examine the covariance behavior
within a protein molecule (intra-protein) and between different protein molecules (inter-protein).
Consistent with the overall LLM model, the distance dependence of the covariance between interprotein atom pairs appears exponential, albeit with deviations below 10 ‚Ñ´ (Fig. 4). The best-fit
values of Œ≥ are 14.3 ‚Ñ´ for the AMBER simulation and 13.4 ‚Ñ´ for the CHARMM simulation, which
are somewhat longer than the value of 11 ‚Ñ´ for all protein pairs. If the subset of inter-protein atom
pairs dominates the statistics of all atom pairs, then it should be most important in determining the
LLM behavior that was observed for all atom pairs. Indeed, beyond a distance of 12 ‚Ñ´, the number
of inter-protein atom pairs sharply climbs above the number of intra-protein atom pairs
(Supplementary Fig. S3), supporting this notion. This finding is consistent with earlier work of
Peck et al.14 showing that including interactions across molecular boundaries improves agreement
with the anisotropic diffuse scattering signal.

10

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

In contrast to the inter-protein atom pairs, the covariance behavior for just the intra-protein
atom pairs deviates from a LLM model. For these atom pairs, the behavior is described by a
mixture of RBM and other contributions. The long-range behavior (above 20 ‚Ñ´) is almost
exclusively explained by RBM, the mid-range behavior (5-20 ‚Ñ´) is dominated by RBM, and in
the short-range region (below 5 ‚Ñ´) the RBM model accounts for only a minority of the covariance.
The observation of RBM here is reminiscent of ssNMR studies of ubiquitin crystals32, 33 in which
MD simulations were used to explain the crystal dynamics; in that study, 3-5 degree rocking
motions were observed via rotational alignment of proteins from the MD trajectory. We note,
however, that 3-5 degrees is much larger than the 1 degree SD that explains the covariance
behavior in Fig. 5. In addition, the present results are consistent with our previous analysis of rigidbody rotations based on rotational alignment of proteins from the MD trajectory28; that analysis
found 1-2 degree SDs of Euler angles and indicated that rigid-body rotations account for a minority
of the atom displacements in staphylococcal nuclease crystalline MD simulations.
After subtracting the RBM contribution from the intra-protein covariance plot, the residual
is well fit by an exponential decay, except below 5 ‚Ñ´. The decay length of the fit is 5.7 ‚Ñ´, which
is substantially shorter than the length found for all atom pairs (11 ‚Ñ´) or just the inter-protein atom
pairs (13.4 ‚Ñ´ and 14.3 ‚Ñ´). As the decay length differs, it is possible that the inter-protein and intraprotein LLM behaviors have different origins in the MD simulations. As the intra-protein LLM
behavior only is apparent after the RBM contribution has been subtracted, it is unlikely to involve
a substantial RBM component; however, it is possible that the inter-protein LLM behavior includes
a component that is due to the coupling of RBM across protein boundaries.34
The value Œ≥ = 6.5 ‚Ñ´ obtained for the LLM fit to staphylococcal nuclease diffuse scattering
data is substantially smaller than the 18 ‚Ñ´ value obtained by Peck et al.14 for LLM models of
diffuse scattering from CypA and WrpA. Peck et al.14 also noted that their values of Œ≥ were larger
than previously published values, and that the difference in length scales for LLM models might
be attributed to their finer sampling of the data. Our results lend support to this explanation for the
discrepancy. In the case of intra-protein atom pairs, we found Œ≥ = 5.7 ‚Ñ´, which is comparable to
the value Œ≥ = 6.5 ‚Ñ´ from the LLM fit. In the case of inter-protein atom pairs, we found Œ≥ = 14.3 ‚Ñ´
(AMBER) or Œ≥ = 13.4 ‚Ñ´ (CHARMM), which is more comparable to the value Œ≥ = 18 ‚Ñ´ from the
Peck et al.14 study. The similarity of these length scales between the fitting and the MD suggests
that both types of motions might be present in the protein crystal. Moreover the comparison of the
length scales between MD analysis and LLM models suggests that the fine-grained sampling might
yield data that emphasize inter-protein motions, and that the coarse-grained sampling might yield
data that emphasize intra-protein motions in the fitting. This possibility motivates future work to
identify regions of reciprocal space where the intra-protein signal is enhanced, helping us to realize
the vision of connecting diffuse scattering to functionally important motions.
Ideas from thermal diffuse scattering theory35 support the possibility that sampling of
diffuse data might preferentially select for different types of motion. As noted by Peck et al.,14
when motions are coupled across unit cell boundaries (as both the present study and their study
suggest might be happening in real crystals), the diffuse intensity becomes tied to the Bragg peaks.
This effect is closely related to thermal diffuse scattering theory in which the intensity has local
maxima at Bragg peak positions and decreases with distance from the peak in a way that is
determined by the spectrum of crystal vibrations.35 14 15 16 2 17 Motions coupled on long length
scales generate intense features that decay sharply moving away from the peaks, and motions
coupled on a shorter length scale contribute less intense features that are spread out over a larger
region of reciprocal space, extending farther from the peaks. Because the coarse sampling in our

11

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

study rejects intensity values within ¬º of a Miller index of each Bragg peak, it is dominated by the
intensity far from the peaks, enriching the signal due to shorter length-scale correlated motions. In
contrast, the finer sampling used by Peck et al.14 includes the data corresponding to long lengthscale correlated motions, which, despite the localization to fewer grid points near the Bragg peaks,
might dominate the fitting due to the higher intensity. In the case of the fine-grained sampling, it
is possible that motions on both length scales might be resolved if a LLM with both a short-range
and long-range exponential were used.36
Although the AMBER and CHARMM simulations yielded similar exponential behavior
for the covariance of all CŒ± atom pairs, a number of differences between the force fields were
revealed in our study. (1) The MD simulation pressure after initial solvation was less negative in
the case of AMBER (-1439 +/- 39 bar) than CHARMM (-1795 +/- 252 bar). (2) In both Figs. 3
and 4, the covariance in the case of AMBER stays below zero except at the longest distances, and
in the case of CHARMM gradually rises to zero after a minimum at around 55 ‚Ñ´. (3) The shortrange behavior differs for the AMBER vs CHARMM simulations. For the CHARMM simulations
(Fig. 4) the exponential behavior continues to short distances. In contrast, for the AMBER
simulations, the covariance in the 3.31 ‚Ñ´ bin is negative: -1.77 +/- 1.23 ‚Ñ´2. (4) The diffuse
intensities predicted from the CHARMM simulation had a somewhat higher correlation with the
data than those from the AMBER simulation (Supplementary Fig. S1). At this time the origin of
the differences is not clear; however, these differences indicate ways in which crystalline MD
simulations, including comparisons to diffuse scattering data, have the potential to distinguish
between force fields, and therefore might be used to increase force field accuracy.
There are some caveats to consider in interpreting our results. For all but the inter-protein
atom pairs, the covariance increases sharply below 5 ‚Ñ´, deviating from the values predicted by
both the LLM and RBM models. Such deviation is not surprising, as short-range interactions are
more sensitive to the details of the chemical environment, and include interactions between
sequential CŒ± atoms across the rigid peptide bond. The MD simulations were conducted while
constraining the distance between all bonded atoms using LINCS constraints, which further
rigidifies the structure, also tending to increase the covariance. Another caveat is that the
exponential fit includes a constant term -- the correlation function does not decay to zero as
distance increases, perhaps due to the translational alignment of trajectory snapshots.27 Note,
however, that such a constant offset corresponds to a constant long-range covariance which
focuses the diffuse intensity directly beneath the Bragg peak. In this way, the long-range
component of the diffuse intensity becomes indistinguishable from the Bragg intensity and does
not appear in the measured diffuse intensity. A third caveat is that our analysis was performed
using only CŒ± atom pairs, and therefore does not take into account the influence of non-CŒ±
backbone or side chain motions on the covariance behavior. In particular, it is possible that the
signature of RBM might not be as clear for side chain atoms as for CŒ± atoms, if the backbone is
more rigid than the side chains. In future work it will be especially important to analyze simulations
in which the bond constraints are relaxed and to overcome the computational difficulties of adding
all heavy atoms, including side chain atoms, to the covariance analysis.
Meinhold and Smith37 performed an analysis of correlated displacements between atom
pairs in MD simulations of crystalline staphylococcal nuclease. Instead of analyzing the covariance
matrix, however, they analyzed the dependence of elements of the correlation matrix on the
distance between atom pairs. The correlation matrix is computed by renormalizing the covariance
matrix, dividing each element by the geometric mean of the values on the diagonal (variances) in
the corresponding row and column for each element. Meinhold and Smith found that the

12

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

correlations of all atom pairs decreased exponentially with a decay length of 11 ‚Ñ´, and that interprotein atom pairs also decreased exponentially, with a longer decay length (11-18 ‚Ñ´, depending
on the simulation). In this respect, the results of our analyses are similar. However, in contrast to
the near linear behavior we found for the covariance of intra-protein atom pairs, they found that
the intra-protein correlations showed an exponential decay behavior. Our analysis therefore
appears to be inconsistent with theirs with respect to the intra-protein atom pairs. We note that
there are several differences between our analyses: on the one hand, Meinhold and Smith37
analyzed the correlation matrix, used a single periodic unit cell, a NPT ensemble, and 10 ns
duration simulations; on the other hand, we analyzed the covariance matrix, used a 2X2X2 periodic
supercell, a NVT ensemble, and 600 ns duration simulations. It is possible that the discrepancy
with respect to the intra-atom pairs is due to one of these differences.
As mentioned above, the correlation of the anisotropic intensity calculated from the LLM
model with the data is 0.73, which is higher than the maximum value of 0.63 for the MD
simulation. The higher correlation of the LLM suggests that it provides a globally more accurate
description of the anisotropic intensity. Although the MD model is lacking in this respect, it still
has advantages over the LLM model. For one, the MD simulation is still the only model that is
capable of reproducing the total intensity ‚Äì isotropic and anisotropic ‚Äì and is therefore the most
accurate overall. Moreover, the MD model is, in some sense, a ‚Äúmodel-free‚Äù model, in that there
are no free parameters to fit ‚Äì the model simply depends on the choice of force-field, and the
assumption that the system behaves classically. Indeed, the LLM model accuracy is substantially
increased due to the ability to refine the free parameters against the experimental data. However
accurate the LLM model may be, it produces a very limited description of the dynamics that does
not contain any mechanistic information, whereas the MD model can provide us with dynamic
structural information that yields functional and biological insight (modulo any inaccuracies
inherent to the forcefield, or due to inadequate sampling and/or simulation length).
Taken together, our results show that MD simulations of a crystalline protein exhibit
LLM behavior. The inter-protein atom pairs exhibit LLM behavior and within the protein the
motions exhibit both LLM and RBM behaviors. Due to the large number of inter-protein vs intraprotein atom pairs, the overall behavior appears LLM-like. These findings provide support and
context for previous results which showed that LLM models of protein diffuse scattering improve
after the inclusion of interactions across protein boundaries. They also provide clues about why
LLM model fits using coarsely sampled diffuse data might yield smaller correlation length scales
than using finely sampled data. Finally, our results suggest that the modeling of finely sampled
diffuse scattering data might be improved by consideration of both small-scale and large-scale
collective motions.

Methods
Molecular-dynamics simulations
The all atom structure for staphylococcal nuclease was pulled from the Protein Data Bank
(wwPDB: 4WOR38 with unit cell a = b = 48.5 ‚Ñ´, c = 63.43 ‚Ñ´, a = b = g = 90 degrees, and space
group P41). This structure is missing the first five residues at the N-terminus and the last eight
residues at the C-terminus. In Ref. 28 the missing N- and C-terminal atoms were reintroduced and
modelled based on extension of secondary structure ‚Äì the same starting structure is used in this
work.
13

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Once fully modelled, the asymmetric unit was propagated to a unit cell and then to a 2x2x2
supercell using the UnitCell and PropPDB methods from AmberTools18.39 The coordinates of the
bound ligand, thymidine-3‚Ä≤-5‚Ä≤-bisphosphate (pdTp), were extracted from the PDB file, saved as a
mol2 file (using UCSF Chimera30), and parameterized using the SwissParam Server
(swissparam.ch40). Two different systems were created: one in which the protein residues were
parameterized with the AMBER 14SB force field41 and another in which they were parameterized
with the CHARMM 27 force field42; both were parameterized using GROMACS43 pdb2gmx
(residue names were set manually and hydrogens present in the initial PDB file were ignored with
flag -ignh, which automatically assigns protonation states for residues at pH 7). These fully
parameterized systems were then solvated with TIP3P waters44 using GROMACS gmx solvate.
The full systems were neutralized with chloride ions (gmx genion). Once solvated, these systems
were minimized using the steepest descent algorithm.
Simulations were performed using a constant particle number, volume, and temperature
(NVT) ensemble, at a temperature of 298K. After an initial round of NVT equilibration to check
the pressure of the system, the number of water molecules was adjusted to achieve nearatmospheric pressure. This was achieved by iterative rounds of solvation and NVT equilibration.
For the CHARMM force field simulation, 100 ps equilibration durations were used, as in previous
studies of the same system.25, 28 For the AMBER force field simulation, 5 ns equilibration durations
were used. After the last round of equilibration, 17,557 waters were added in the AMBER
simulation, and 17,138 waters were added in the CHARMM simulation.
The crystallographic protein heavy atoms (i.e. non-terminal heavy atoms) were restrained
to the minimized crystal structure during all rounds of equilibration and the initial 100ns restrained
production simulation (restraint force constant k=1000 kJ mol-1 nm-2). Restraints were then
released and production simulation was carried out for 600ns. All rounds of equilibration and
production were carried out using the leap-frog algorithm (integrator=md); neighbor searching
was carried out using the Verlet cutoff-scheme45 with an update frequency of 10 frames (niter=10),
and a cutoff distance for the short range neighbor list of 1.5 nm (rlist=1.5); all bonds were
constrained with the LINCS algorithm (constraints=all-bonds; constraint-algorithm=LINCS).46

Covariance matrix of atom displacements
After releasing restraints, the simulations require on the order of 100ns for the RMSD of the protein
CŒ± coordinates to plateau. To ensure that the system was fully equilibrated after the release of
restraints, analysis began at 200ns in to unrestrained production. CŒ± trajectory subsets were
extracted from the full unrestrained production trajectories from 200-600ns in both simulations.
To do this, the first frame (200ns into unrestrained production) was extracted, and the CŒ±
coordinates were isolated using gmx editconf (with flag -pbc to ensure molecules stay whole).
Then, a 400ns CŒ± trajectory was created using gmx trjconv, and subsequently translationally fit to
the starting structure using the CŒ± starting frame as reference (gmx trjconv ‚Ä¶ -s
c_alpha_supercell_pbc.gro ‚Ä¶ -fit translation). The CŒ± trajectory covariance information was
calculated using gmx covar (once again, using the CŒ± structure from the first frame as reference).
With 32 proteins, each containing 149 CŒ± atoms, and a 3 by 3 covariance submatrix for
each pair of CŒ± atoms, the full covariance matrix computed by gmx covar is a 14,304 by 14,304
block matrix. The diagonal elements of this matrix correspond to the mean squared deviation
(MSD) for each atom, in each direction; these diagonal elements were ignored in subsequent
analysis. After computing the trace of each atoms-pair‚Äôs 3 by 3 submatrix, the covariance matrix

14

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

is 4,768 by 4,768 (Supplementary Fig. S2). These pairwise CŒ± covariances were sorted by their
distances apart, using a matrix of pairwise CŒ± distances (Supplementary Fig. S2) computed using
MDTraj47 and the average coordinates reported by gmx covar for each CŒ± trajectory subset.
Covariance matrix data was processed, analyzed, and plotted using python‚Äôs numpy, scipy, and
matplotlib. The covariance as a function of distance data was fit to an exponential decay model
using gnuplot, and errors in the parameters reported in the Results section are the asymptotic
standard errors reported by gnuplot.

Rigid-body motions model
To investigate the source of the non-exponential decrease in covariance as a function of distance
for residue pairs within proteins, we created a Python script to simulate RBM
(RigidBodyMotions.py). The script creates hypothetical trajectories consisting of a rigid protein
randomly rotated and translated by amounts on par with the magnitude of motion observed in our
MD simulations. We compared the covariance behavior computed from these "trajectories" with
that observed in the crystalline MD simulations. This allowed us to determine the degree to which
a rigid-body rotation and translation model can explain the MD covariance behavior.
The Python script generates covariance data as follows:
(1) The structure of a single protein is pulled from the crystalline MD starting structure,
and centered on the origin (using mdtraj.Trajectory().center_coordinates()); terminal
atoms missing from the PDB structure are disregarded, as they cannot reasonably be
considered rigid.
(2) Rotations are generated by sampling three Euler angles, each from a normal distribution
with mean zero and a specified standard deviation; similarly, translations are generated
by sampling a three-dimensional vector from a normal distribution with mean at the
origin and a specified standard deviation, the same for all directions.
(3) A new ‚Äúframe‚Äù is created by first rotationally moving and then translationally moving
the starting structure; for rotational moves, a rotation matrix is generated from the Euler
angles, and the matrix vector product of the rotation matrix and the coordinates of each
atom is performed (with numpy.dot()); for translations, the random three-dimensional
translation vector is added to each atom‚Äôs coordinates.
(4) A ‚Äútrajectory‚Äù is built up frame by frame, and the covariance is calculated as a function
of the distance between atoms, as described above for simulation trajectories.
In this study we used 5000 frames for our analysis. The covariance data produced was
compared with the covariance data from equivalent atoms in the simulation (non-terminal CŒ± atom
pairs within proteins). Reasonable parameters for the Euler angle and translational distributions
were arrived at by manual adjustment of the standard deviations, seeking the best visual overlap
between the model and the data.

Diffuse scattering
Diffuse scattering data for staphylococcal nuclease were obtained from past experiments38 and
were processed as described in Ref. 28. In addition to studying the liquid-like motions behavior of
the atom displacement covariance matrix, the MD trajectories themselves can be processed directly
15

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

to predict the diffuse scattering. The diffuse scattering is the variance of the structure factor of
independent repeating units in the crystal, according to Guinier‚Äôs equation,48 and previous studies
have predicted the diffuse scattering from protein crystal MD trajectories by computing the
structure factor, frame-by-frame.25, 27, 28, 37, 49 This is done as in Ref. 28 using the script
get_diffuse_from_md.py, which takes in a trajectory and outputs .mtz (byte stream) and .dat (ascii)
reflection data; then, reflected data is processed with the Lunus diffuse scattering data processing
software suite (https://github.com/mewall/lunus). The same script and processing software were
used in this work.
Diffuse scattering simulations were calculated from the last 400ns of the trajectories. As in
Ref. 28, the intensities were computed on a 3D grid sampling reciprocal space twice as finely as
the Bragg lattice. The trajectory was produced in 100ns chunks, and the diffuse scattering was
calculated from these 100ns chunks independently, and then accumulated either (a) coherently, by
accumulating the complex structure factors (flag -merge=True) or (b) incoherently, by averaging
the intensities themselves from each 100ns chunk using Lunus methods sumlt and mulsclt. The
model diffuse scattering was converted to a lattice file using hkl2lat, with the experimental lattice
file as a template, then symmetrized and culled using symlt and culllt, and the anisotropic
component of the diffuse scattering was separated using anisolt. Pearson correlations between the
models and the data were computed using corrlt.
Simulated diffraction images in Fig. 2 and Supplementary Fig. S4 were computed from
models or data in a similar way to that in Ref. 28. To simulate diffraction using a 3D grid model
or data, the minimum value was computed within shells and was subtracted from each 3D grid
point, using interpolation (subminlt). The diffraction pattern corresponding to a specified crystal
orientation was simulated from the 3D grid using the simulate_diffraction_image.py Python script
distributed with Lunus.
For the refinement of the LLM, we processed the data using a recent version of Lunus
(https://github.com/mewall/lunus). As in the original staphylococcal nuclease study 38, the data
were coarsely sampled using one point per Miller index. The data were processed to a resolution
limit of 1.6 ‚Ñ´. Intensity values within ¬º of a Miller index of each Bragg peak were excluded from
the processing. The 3D data were symmetrized using the P4 Laue symmetry, and the isotropic
component was removed as described in Ref. 28. The structure factors from the 4WOR crystal
structure were used to refine a LLM model (python refine_llm.py symop=-3 model=llm
bfacs=zero).

Acknowledgments
This work was supported by the University of California Laboratory Fees Research Program.
MEW is also supported by the Exascale Computing Project (17-SC-20-SC), a collaborative effort
of the U.S. Department of Energy Office of Science and the National Nuclear Security
Administration. JSF is also supported by NSF STC-1231306. The simulations were performed
using Institutional Computing machines at Los Alamos National Laboratory, supported by the U.S.
Department of Energy under Contract 89233218CNA000001.

16

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

References
1.
D. A. Keen and A. L. Goodwin, Nature 521 (7552), 303-309 (2015).
2.
M. E. Wall, A. M. Wolff and J. S. Fraser, Curr. Opin. Struct. Biol. 50, 109-116 (2018).
3.
S. P. Meisburger, W. C. Thomas, M. B. Watkins and N. Ando, Chem. Rev. 117 (12), 76157672 (2017).
4.
J. M. Holton, S. Classen, K. A. Frankel and J. A. Tainer, FEBS J. 281 (18), 4046-4060
(2014).
5.
H. van den Bedem and J. S. Fraser, Nat. Methods 12 (4), 307-318 (2015).
6.
V. Schomaker and K. N. Trueblood, Acta Crystallogr. B 24 (1), 63-76 (1968).
7.
F. Zucker, P. C. Champ and E. A. Merritt, Acta Crystallogr. D Biol. Crystallogr. 66 (Pt 8),
889-900 (2010).
8.
R. A. Woldeyes, D. A. Sivak and J. S. Fraser, Curr. Opin. Struct. Biol. 28, 56-62 (2014).
9.
D. A. Keedy, J. S. Fraser and H. van den Bedem, PLoS Comput. Biol. 11 (10), e1004507
(2015).
10.
J. L. Smith, W. A. Hendrickson, R. B. Honzatko and S. Sheriff, Biochemistry 25 (18),
5018-5027 (1986).
11.
P. B. Moore, Structure 17 (10), 1307-1315 (2009).
12.
A. H. Van Benschoten, P. V. Afonine, T. C. Terwilliger, M. E. Wall, C. J. Jackson, N. K.
Sauter, P. D. Adams, A. Urzhumtsev and J. S. Fraser, Acta Crystallogr. D Biol. Crystallogr. 71 (Pt
8), 1657-1667 (2015).
13.
M. E. Wall, P. D. Adams, J. S. Fraser and N. K. Sauter, Structure 22 (2), 182-184 (2014).
14.
A. Peck, F. Poitevin and T. J. Lane, IUCrJ 5 (Pt 2), 211-222 (2018).
15.
T. de Klijn, A. M. M. Schreurs and L. M. J. Kroon-Batenburg, IUCrJ 6 (Pt 2), 277-289
(2019).
16.
H. N. Chapman, O. M. Yefanov, K. Ayyer, T. A. White, A. Barty, A. Morgan, V. Mariani,
D. Oberthuer and K. Pande, J. Appl. Crystallogr. 50 (Pt 4), 1084-1103 (2017).
17.
Y. S. Polikanov and P. B. Moore, Acta Crystallogr. D Biol. Crystallogr. 71 (Pt 10), 20212031 (2015).
18.
D. L. Caspar, J. Clarage, D. M. Salunke and M. Clarage, Nature 332 (6165), 659-662
(1988).
19.
B. T. Burnley, P. V. Afonine, P. D. Adams and P. Gros, Elife 1, e00311 (2012).
20.
E. J. Levin, D. A. Kondrashov, G. E. Wesenberg and G. N. Phillips, Jr., Structure 15 (9),
1040-1052 (2007).
21.
D. Riccardi, Q. Cui and G. N. Phillips, Jr., Biophys. J. 99 (8), 2616-2625 (2010).
22.
W. F. van Gunsteren and M. Karplus, Nature 293 (5834), 677-678 (1981).
23.
P. A. Janowski, D. S. Cerutti, J. Holton and D. A. Case, J. Am. Chem. Soc. 135 (21), 79387948 (2013).
24.
P. A. Janowski, C. Liu, J. Deckman and D. A. Case, Protein Sci. 25 (1), 87-102 (2016).
25.
M. E. Wall, A. H. Van Benschoten, N. K. Sauter, P. D. Adams, J. S. Fraser and T. C.
Terwilliger, Proc. Natl. Acad. Sci. U. S. A. 111 (50), 17887-17892 (2014).
26.
J. B. Clarage, T. Romo, B. K. Andrews, B. M. Pettitt and G. N. Phillips, Jr., Proc. Natl.
Acad. Sci. U. S. A. 92 (8), 3288-3292 (1995).
27.
L. Meinhold and J. C. Smith, Biophys. J. 88 (4), 2554-2563 (2005).
28.
M. E. Wall, IUCrJ 5 (Pt 2), 172-181 (2018).
29.
M. E. Wall, IUCrJ 5 (Pt 2), 120-121 (2018).
17

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

30.
E. F. Pettersen, T. D. Goddard, C. C. Huang, G. S. Couch, D. M. Greenblatt, E. C. Meng
and T. E. Ferrin, J. Comput. Chem. 25 (13), 1605-1612 (2004).
31.
A. Arvai (2012). ADXV -- a program to display X-ray diffraction images. Scripps Research
Institute, La Jolla, CA.
32.
V. Kurauskas, S. A. Izmailov, O. N. Rogacheva, A. Hessel, I. Ayala, J. Woodhouse, A.
Shilova, Y. Xue, T. Yuwen, N. Coquelle, J. P. Colletier, N. R. Skrynnikov and P. Schanda, Nat
Commun 8 (1), 145 (2017).
33.
P. Ma, Y. Xue, N. Coquelle, J. D. Haller, T. Yuwen, I. Ayala, O. Mikhailovskii, D.
Willbold, J. P. Colletier, N. R. Skrynnikov and P. Schanda, Nat Commun 6, 8361 (2015).
34.
J. Doucet and J. P. Benoit, Nature 325 (6105), 643-646 (1987).
35.
R. W. James, The Optical Principles of the Diffraction of X-Rays. (G. Bell and Sons,
London, 1948).
36.
J. B. Clarage, M. S. Clarage, W. C. Phillips, R. M. Sweet and D. L. Caspar, Proteins 12
(2), 145-157 (1992).
37.
L. Meinhold and J. C. Smith, Proteins 66 (4), 941-953 (2007).
38.
M. E. Wall, S. E. Ealick and S. M. Gruner, Proc. Natl. Acad. Sci. U. S. A. 94 (12), 61806184 (1997).
39.
D. A. Case, I. Y. Ben-Shalom, S. R. Brozell, D. S. Cerutti, I. T.E. Cheatham, V. W. D.
Cruzeiro, T. A. Darden, R. E. Duke, D. Ghoreishi, M. K. Gilson, H. Gohlke, A. W. Goetz, D.
Greene, R. Harris, N. Homeyer, S. Izadi, A. Kovalenko, T. Kurtzman, T. S. Lee, S. LeGrand, P.
Li, C. Lin, J. Liu, T. Luchko, R. Luo, D. J. Mermelstein, K. M. Merz, Y. Miao, G. Monard, C.
Nguyen, H. Nguyen, I. Omelyan, A. Onufriev, F. Pan, R. Qi, D. R. Roe, A. Roitberg, C. Sagui, S.
Schott-Verdugo, J. Shen, C. L. Simmerling, J. Smith, R. Salomon-Ferrer, J. Swails, R. C. Walker,
J. Wang, H. Wei, R. M. Wolf, X. Wu, L. Xiao, D. M. York and P. A. Kollman (2019). AMBER
2018. University of California, San Francisco.
40.
V. Zoete, M. A. Cuendet, A. Grosdidier and O. Michielin, J. Comput. Chem. 32 (11), 23592368 (2011).
41.
J. A. Maier, C. Martinez, K. Kasavajhala, L. Wickstrom, K. E. Hauser and C. Simmerling,
J. Chem. Theory Comput. 11 (8), 3696-3713 (2015).
42.
A. D. MacKerell, Jr., N. Banavali and N. Foloppe, Biopolymers 56 (4), 257-265 (2000).
43.
H. J. C. Berendsen, D. van der Spoel and R. van Drunen, Comput. Phys. Commun. 91 (1),
43-56 (1995).
44.
W. L. Jorgensen, J. Chandrasekhar, J. D. Madura, R. W. Impey and M. L. Klein, The
Journal of Chemical Physics 79 (2), 926-935 (1983).
45.
S. P√°ll and B. Hess, Comput. Phys. Commun. 184 (12), 2641-2650 (2013).
46.
B. Hess, H. Bekker, H. J. C. Berendsen and J. G. Fraaije, J. Comput. Chem. 18 (12), 14631472 (1997).
47.
R. T. McGibbon, K. A. Beauchamp, M. P. Harrigan, C. Klein, J. M. Swails, C. X.
Hern√°ndez, C. R. Schwantes, L.-P. Wang, T. J. Lane and V. S. Pande, Biophys. J. 109 (8), 15281532 (2015).
48.
A. Guinier, X-ray Diffraction in Crystals, Imperfect Crystals, and Amorphous Bodies. (W.
H. Freeman and Company, San Francisco, 1963).
49.
L. Meinhold and J. C. Smith, Phys Rev Lett 95 (21), 218103 (2005).

18

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Supplementary Information

Figure S1. Agreement between 3D diffuse scattering data and simulations computed using sections
of the MD trajectory. Values of the Pearson correlation coefficient are computed as a figure of
merit. AMBER values are in red, CHARMM in blue. Left. Agreement computed using individual
100 ns sections after the 200 ns time point (200-300, 300-400, 400-500, and 500-600 ns). Values
do not systematically increase or decrease with the simulation time. Center. Simulations computed
using trajectories accumulated coherently after the 200 ns time point (see Methods for definition
of coherent accumulation): (200-300, 200-400, 200-500, and 200-600 ns). The AMBER values
decrease and the CHARMM values increase with increasing time. Right. Simulations computed
using trajectories accumulated incoherently across 100 ns sections after the 200 ns time point (see
Methods for definition of incoherent accumulation). Both the AMBER and CHARMM values
increase with increasing time. Incoherent accumulation results in the highest correlation with the
diffuse scattering data, and the CHARMM correlation is higher than the AMBER correlation in
all cases.

19

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Figure S2. Visualization of values from the CŒ± atom displacement covariance matrix (upper right
triangle) and the CŒ± atom distance matrix (lower left triangle). Rows and columns correspond to
CŒ± atoms (the image shows only a sampling of the values from the full matrix and merely
illustrates the overall structure of the data, as the resolution is insufficient to show values for all
atom pairs). Tics indicate breaks between each of eight unit cells. The finer squares within each
unit cell correspond to four copies of the proteins, each of which has 149 CŒ± atoms. The covariance
values in the upper right triangle range from -0.2 (dark red) to 0 (white) to + 0.2 (dark blue), with
values above or below in absolute value visualized as the same dark blue/red color. The distance
values in the lower left triangle range from 0 (dark blue) to 92 ‚Ñ´ (white). The blocks along the
diagonal correspond to intra-protein atom pairs; for these blocks, the covariance tends to be
positive (blue) and the distances are short (also blue). All other blocks correspond to inter-protein
atom pairs; for these blocks, there are more negative covariance values than for the intra-protein
blocks.
20

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Figure S3. Number of CŒ± atom pairs as a function of distance in the full supercell. Intra-protein
(within) atom pairs are shown in blue; inter-protein (across) atom pairs are shown in orange. The
number of pairs across proteins outnumber the residue pairs within proteins for all distances greater
than 12 ‚Ñ´ (inset).

21

bioRxiv preprint doi: https://doi.org/10.1101/811083; this version posted October 18, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-ND 4.0 International license.

Figure S4. Simulated diffraction images from LLM model (left) and 3D experimental diffuse data
(right). Both the data and model were generated using coarse sampling of one measurement per
Miller index. Outside of the region at low resolution near the origin (which, despite the small
contribution of this region in determining the quantitative agreement, can dominate the visual
comparison due to its central position), similar features are identifiable between the two images.
The images were displayed using the heat map mode of ADXV.31

22

