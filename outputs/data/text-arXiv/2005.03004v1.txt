Adaptive Invariance for Molecule Property Prediction

arXiv:2005.03004v1 [q-bio.QM] 5 May 2020

Wengong Jin Regina Barzilay Tommi Jaakkola
CSAIL, Masssachusetts Institute of Technology
{wengong,regina,tommi}@csail.mit.edu

Abstract
Effective property prediction methods can help accelerate the search for COVID-19
antivirals either through accurate in-silico screens or by effectively guiding ongoing at-scale experimental efforts. However, existing prediction tools have limited
ability to accommodate scarce or fragmented training data currently available. In
this paper, we introduce a novel approach to learn predictors that can generalize
or extrapolate beyond the heterogeneous data. Our method builds on and extends
recently proposed invariant risk minimization, adaptively forcing the predictor
to avoid nuisance variation. We achieve this by continually exercising and manipulating latent representations of molecules to highlight undesirable variation
to the predictor. To test the method we use a combination of three data sources:
SARS-CoV-2 antiviral screening data, molecular fragments that bind to SARSCoV-2 main protease and large screening data for SARS-CoV-1. Our predictor
outperforms state-of-the-art transfer learning methods by significant margin. We
also report the top 20 predictions of our model on Broad drug repurposing hub.

1

Introduction

The race to identify promising repurposing drug candidates against COVID-19 calls for improvements
in the underlying property prediction methodology. The accuracy of many existing techniques
depends heavily on access to reasonably large, uniform training data. Such high-throughput, on
target screening data is not yet publicly available for COVID-19. Indeed, we have only 48 drugs with
measured in-vitro SARS-CoV-2 activity shared with the research community [6]. This limited data
scenario is not unique to the current pandemic but likely to recur with each evolving or new viral
challenge. The ability to make accurate predictions based on all the available data, however limited,
is also helpful in guiding later high-throughput targeted experimental effort.
We can supplement scarce on-target data with other related data sources, either related screens
pertaining to COVID-19 or screens involving related viruses. For instance, we can use additional
data pertaining to molecular fragment screens that measure binding to SARS-CoV-2 main protease,
obtained via crystallography screening [9]. On average, these fragments consist of only 14 atoms,
comprising roughly 37% of full drug size molecules. Another source of data is SARS-CoV-1 screens.
Since SARS-CoV-1 and SARS-CoV-2 proteases are similar (more than 79% sequence identity) [12],
drugs screened against SARS-CoV-1 can be expected to be relevant for SARS-CoV-2 predictions.
These two examples highlight the challenges for property prediction tools: much of the available
training data comes from either different chemical space (molecular fragments) or different viral
species (SARS-CoV-1).
The key technological challenge is to be able to estimate models that can extrapolate beyond their
training data, e.g., to different chemical spaces. The ability to extrapolate implies a notion of
invariance (being impervious) to the differences between the available training data and where
predictions are sought. A recently proposed approach known as invariant risk minimization (IRM) [1]
seeks to find predictors that are simultaneously optimal across different such scenarios (called
environments). Indeed, the differences in chemical spaces can be thought as "nuisance variation" that

the predictor should be explicitly forced to ignore. One possible way to automatically define this type
of environment variability for molecules is scaffolds [2]. But the setting is challenging since scaffolds
are combinatorial descriptors (substructures) and can potentially uniquely identify each compound in
the training data. Useful environments for estimation should enjoy some statistical support.
In this paper we propose a novel variant of invariant risk minimization specifically tailored to rich,
combinatorially defined environments typical in molecular contexts. Indeed, unlike in standard IRM,
we introduce two dynamic (in contrast to many static) environments. These are defined over the same
set of training examples, but differ in terms of their associated latent representations. The difference
between them arises from continually adjusted perturbations that manipulate the latent representations
of compounds towards more “generic” versions with the help of a scaffold classifier. The idea is to
explicitly highlight to the property predictor that operates on these latent representations what the
nuisance variability is that it should not rely on.
Our method is evaluated on existing SARS-CoV-2 screening data [9, 6]. The training utilizes
three sources of data: SARS-CoV-2 screened molecules, SARS-CoV-2 fragments and SARS-CoV-1
screening data described above. We compare against multiple transfer learning techniques such as
domain adversarial training [5] and conditional domain adversarial network [7]. On two SARS-CoV2 datasets, the proposed approach outperforms the best performing baseline with 8-16% relative
AUROC improvement. Finally, we apply our model on Broad drug repurposing hub [4] and report
the top 20 predictions for further investigation.

2

Domain Extrapolation

Training data in many emerging applications is necessarily limited, fragmented, or otherwise heterogeneous. It is therefore important to ensure that model predictions derived from such data generalize
substantially beyond where the training samples lie. In other words, the trained model should have the
ability to extrapolate. For instance, in computational chemistry, it is desirable for property prediction
models to perform well in time-split scenarios where the evaluation concerns compounds that were
created after those in the training set. Another way to simulate evaluation on future compounds is
through a scaffold split [2]. A scaffold split between training and test introduces some structural
separation between the chemical spaces of the two sets of compounds, hence evaluating the model’s
ability to extrapolate to a new domain.
One way to ensure domain extrapolation is to enforce an appropriate invariance criterion during
training. We envision here that the compounds X can be divided into potentially a large number
of domains or “environments” E, for example, based on their scaffold. The goal is then to learn a
parametric mapping Z = φ(X) of compounds X to their latent representations Z in a manner that
satisfies the chosen invariance criterion. A number of such strategies relevant to extrapolation have
been proposed. They can be roughly divided into the following three categories:
• Domain adversarial training [5] enforces the latent representation Z = φ(X) to have the same
distribution across different domains E. If we denote by P (X|E) the conditional distribution
of compounds in environment E, then we want P (φ(X)|E) = P (φ(X)) for all E. With some
abuse of notation, we can write this condition as Z ⊥ E. A single predictor is learned based
on Z = φ(X), i.e., all the domains share the same predictor. As a result, the predicted label
distribution P (Y ) will also be the same across the domains. This can be problematic when the
training and test domains have very different label distributions [11]. The independence condition
itself can be challenging to satisfy when the chemical spaces overlap across the environments.
• Conditional domain adaptation [7] relaxes the requirement that the label distributions must agree
across the environments. The key idea is to condition the invariance criterion on the label. In
other words, we require that P (φ(X)|E, Y ) = P (φ(X)|Y ) for all E and Y , i.e., we aim to satisfy
the independence statement Z ⊥ E | Y . The formulation allows the label distribution to vary
between domains since E and Y can depend on each other. The constraint remains, however,
too restrictive about the latent representation. To illustrate this, consider a simple case where the
environments share the same chemical space and differ only in terms of proportions of different
types of compounds in them. These type proportions play roles analogous to label proportions
in domain adversarial training. Hence, the only way to achieve Z ⊥ E | Y would be if the
proportions were the same across environments. To state the example differently, a functional
mapping Z = φ(X) cannot fractionally assign probability mass placed on X to different latent
2

Figure 1: Left: Illustration of base GCN model for molecule property prediction. Right: IRM
with adaptive environments. The model perturbs the representation φ(x) into φ(x) + δ(x) using the
gradient from scaffold classifier g. The predictor f is trained to be simultaneously optimal across two
environments. The scaffold s is a subgraph of a molecule x with its side chains removed [2].
space locations Z; it all has to be mapped to a single location. To reduce the impact of the strict
condition, we would have to introduce P (Z|φ(X), E) in place of the simpler functional mapping
Z = φ(X), further complicating the approach.
• Invariant risk minimization (IRM) [1] seeks a different notion of invariance, focusing less on
aligning distributions of latent representations, and instead shifting the emphasis on how those
representations can be consistently used for predictions. The IRM principle requires that the
predictor f operating on Z = φ(X) is simultaneously optimal across different environments or
domains. For example, this holds if our representation explicates only features that are (causally)
necessary for the correct prediction. How φ(X) is distributed across the environments is then
immaterial. The associated conditional independence criterion is Y ⊥ E | Z. In other words,
knowing the environment shouldn’t provide any additional information about Y beyond the features
Z = φ(X). The distribution of labels can differ across the environments.
While the IRM principle provides a natural framework for domain extrapolation, it needs to be
extended in several ways for our setting. The main limitation of the original framework is that the
environments E themselves are fixed and pre-defined. Their role in the pricinple is to illustrate
“nuisance” variation, i.e., variability that the predictor should learn not to rely on. In order to
enforce the associated independence criterion, we need a fair number of examples within each such
environment. The approach therefore becomes unsuitable when the natural environments such as
scaffolds are combinatorially defined or otherwise have high cardinality. Indeed, we might have only
a single molecule per environment in our training set, making the independence criterion vacuous (E
would uniquely specify X, thus also Z and Y ). A straightforward remedy for the high cardinality
environments would be to introduce a coarser definition, and enforce the principle at this coarse
level instead. Since environments represent constraints on the predictor, their role in estimation is
adversarial. What is then the appropriate trade-off between such a coarser definition (relaxation of
constraints) and our ability to predict? We side-step having to answer this question, and instead
propose to dynamically map the large number of environments to just two. These two environments
are designed to nevertheless highlight the nuisance variation the predictor should avoid but do so in a
tractable manner.

3

IRM with adaptive environments

Our goal is to adaptively highlight to the predictor the type of variability that it ought not to rely
on. We do this by replacing high cardinality environments such as those based on scaffold with
just two new environments. These two new environments are unusual in the sense that they share
the exact same set of examples. Indeed, they only differ in terms of the representation that the
predictor operates on. The first environment simply corresponds to the representation we are trying
to learn, i.e., z = φ(x), where the lowercase letters refer to specific instances rather than random
variables. The second environment is defined in terms of a modified representation φ(x) + δ(x) that
is a perturbed version of φ(x) and constructed with the help of the environment or scaffold classifier.
3

The goal of δ(x) is to explicate directions in the latent representation that the predictor should avoid
paying attention to. While traditional IRM environments divide examples x into environments, often
exclusively, we instead exercise different latent representations over the same set of examples.
More formally, our two environments correspond to a choice of perturbation h ∈ {0, δ} used to derive
the latent representation z from x, i.e., φ(x) + h(x). The associated target labels are clearly the same
regardless of which perturbation (none or δ(x)) was chosen. The key part of our approach pertains to
how δ(x) is defined. To this end, let g(φ(x))) be a parametric environment classifier that we will
instantiate in detail later. The associated classification loss is `(s(x), g(φ(x))) where s(x) is the
correct original environment label (here a scaffold) for x. The scaffold classifier is evolved together
with the feature mapping φ and the associated predictor f . We define the non-zero perturbation δ(x)
in terms of the gradient:
δ(x) = α∇z `(s(x), g(z))|z=φ(x)
(1)
where α is a step size parameter. The goal of this perturbation is to turn φ(x) into its “generic”
version φ(x) + δ(x) which contains less information of the environment (e.g., scaffold). Note that if
we were to perform adversarial domain alignment, δ(x) would represent a reverse gradient update
to modify φ(x). We do not do that, instead we are using the perturbation to highlight directions of
variability to avoid for the predictor f within an overall IRM formulation. The degree to which φ(x)
is adjusted in response to δ(x) arises from the IRM principle, not from a direct alignment objective.
We begin by building the overall training objective which is then optimized in batches as described
in Algorithm 1. Let (xi , yi ) be a pair of training example + the associated label to predict. Each xi
also has an environment label/features given by si = s(xi ) (the original mapping of examples to
environments is assumed given and fixed, defined by s(x)). The environment classifier is trained to
minimize
X
Le (g ◦ φ) =
`(si , g(φ(xi )))
(2)
i

As we will explain later on, the environment classifier remains “unaware” of how the perturbation is
derived on the basis of its predictions. The loss of the predictor f , now operating on φ(x) + h(x),
where h ∈ {0, δ}, is defined as
X

L(f ◦ (φ + h)) =
` yi , f (φ(xi ) + h(xi ))
h ∈ {0, δ}
(3)
i

The specific form of the loss depends on the prediction task. In accordance with the IRM principle,
we enforce that the predictor operating on z = φ(x) + h(x) remains optimal whether its input is φ(x)
or the perturbed version φ(x) + δ(x). In other words, we require that
L(f ◦ (φ + h)) ≤ min L(fh ◦ (φ + h))
h∈{0,δ}

(4)

where fh is a predictor in the same parametric family as f but trained separately with the knowledge
of h (perturbed or not). By relaxing the constraints via Lagrange multipliers, we express the overall
training objective as

X 
λe Le (g ◦ φ) +
(1 + λh )L(f ◦ (φ + h)) − λh L(fh ◦ (φ + h))
(5)
h∈{0,δ}

This minimax objective is minimized with respect to φ, g, and f , and maximized with respect to fh ,
h ∈ {0, δ}. A few remarks are necessary concerning this objective:
• Even though δ is defined on the basis of φ and the environment classifier g, we view it as a
functionally independent player. The goal of δ is to enforce optimality of f and therefore it plays
an adversarial role relative to f . Similarly to GAN objectives where the discriminator has a separate
objective function, different from the generator, we separate out δ as another player in an overall
game theoretic objective. Specifically, δ takes input from φ and g but does not inform them in
return in back-propagation.1
• φ in our objective is adjusted to also help the auxiliary environment classifier. This is contrary
to domain alignment where the goal would be to take out any dependence on the environment.
The benefit in our formulation is two-fold. First, the term grounds φ also based on the auxiliary
1

Incorporating this higher order dependence would not improve the empirical results.

4

Algorithm 1 Training IRM with adaptative environments
1: for each training step do
2:
Sample a batch of molecules {x1 , · · · , xn } with their environments {s1 , · · · , sn }
3:
Encode molecules {x1 , · · · , xn } into vectors {φ(x1 ), · ·P
· , φ(xn )}
4:
Computed environment classification loss Ls (g ◦ φ) = i `(si , g(φ(xi ))).
5:
Construct perturbed representation δ(xi ) = −α∇φ(xi ) `(si , g(φ(xi )))
6:
Compute invariant predictor loss L(f ◦ φ)
7:
Compute competing predictor loss L(fh ◦ (φ + h)) h ∈ {0, δ}
8:
Update φ, f, g to minimize Eq. (5)
9:
Update f0 , fδ to maximize Eq. (5)
10: end for
objective, helping it to retain useful information about each example x. Second, the term grounds
and stabilizes the definition of δ as the gradient of the environment predictor since g no longer approaches a random predictor. It would be weak if φ contains no information about the environment
as in domain alignment. Thus δ remains well-defined as a direction throughout the optimization.
The training procedure is shown in Algorithm 1.
3.1

Adapting the framework to molecule property prediction

In molecule property prediction, the training data is a collection of pairs {(xi , yi )}, where xi is a
molecular graph and yi is its activity score, typically binary (active/inactive). The feature extractor
φ(·) is a graph convolutional network (GCN) which translates a molecular graph into a continuous
vector through directed message passing operations [10]. The predictor f is a feed-forward network
that takes φ(x) or φ(x) + δ(x) as input and yields predicted activity y.
The original environment of each compound xi is defined as its Murcko scaffold [2], which is a
subgraph of xi . Since scaffold is a combinatorial object with a large vocabulary of possible values,
we define and train the environment classifier in a contrastive fashion [8]. Specifically, for a given
molecule xi with scaffold si , we randomly sample n other molecules and take their associated
scaffolds {sk } as negative examples, as the contrastive set C. The environment classifier g makes use
of a feed-forward network gs that maps each compound or a scaffold (subgraph) to a feature vector.
The probability that xi is mapped to its correct scaffold si is then defined as

exp{sim gs (φ(xi )), gs (φ(si )) }

Pg (s = si |xi , C) = P
(6)
k∈{i}∪C exp{sim gs (φ(xi )), gs (φ(sk )) }
where sim(·, ·) stands for cosine similarity. In practice, we use the molecules within the same batch
as negative examples.

4

Experiments

Our experiments consist of two settings. To compare our method with existing transfer learning
techniques, we first evaluate our methods on a standard unsupervised transfer setup. All the models
are trained on SARS-CoV-1 data and tested on SARS-CoV-2 compounds. Next, in order to identify
drug candidates for SARS-CoV-2, we extend our method by incorporating labeled SARS-CoV-2 data
to maximize prediction accuracy and perform virtual screening over Broad drug repurposing hub [4].
Training data Our training data consist of three screens related to SARS-CoV. All the data can be
found at https://github.com/yangkevin2/coronavirus_data.
• SARS-CoV-2 MPro inhibition 881 fragments screened for SARS-CoV-2 main protease (Mpro)
collected by the Diamond Light Source group [9]. The dataset contains 78 hits.
• SARS-CoV-2 antiviral activity 48 FDA-approved drugs screened for antiviral activity against
SARS-CoV-2 in vitro [6], including reference drugs such as Remdesivir, Lopinavir and Chloroquine.
The dataset contains 27 hits.
• SARS-CoV-1 3CLpro inhibition Over 290K molecules screened for activity against SARS-CoV1 3C-like protease (3CLpro) in PubChem AID1706 assay. There are 405 active compounds.
5

Baselines

We compare the proposed approach with the following baselines:

• Direct transfer: We train a GCN on SARS-CoV-1 data and directly test it on SARS-CoV-2 data.
• Domain adversarial training (DANN) [5]: Since distribution of molecules is different between
SARS-CoV-1 and SARS-CoV-2 datasets, we use domain adversarial training to facilitate transfer.
Specifically, we augment our GCN with additional domain classifier g to enforce the distribution
of φ(x) to be the same across training (SARS-CoV-1) and test set (SARS-CoV-2).
• Conditional adversarial domain adaptation (CDAN) [7] conditions the domain classifier g with
predicted labels f (φ(x)). In particular, we adopt their multilinear conditioning strategy: the input
to g becomes a vector outer-product φ(x) ⊗ f (φ(x)), which has the same dimension as φ(x) for
binary classification tasks.
• Scaffold adversarial training (SANN): This is an extension of DANN where the domain classifier
g is replaced with our scaffold classifier gs in Eq.(6). SANN seeks to learn a scaffold-invariant
representation φ(x) through the following minimax game (Le is scaffold classification loss):
min max L(f ◦ φ) − λe Le (gs ◦ φ)
φ,f

g

(7)

• Invariant risk minimization (IRM): The original IRM [1] requires the predictor f to be constant,
which does not work well in our setting. Therefore, we adopt an adversarial formulation for IRM
proposed in [3], allowing us to use powerful neural predictors:
X
min max
(1 + λe )L(f ◦ φ) − λe L(fe ◦ φ)
(8)
φ,f f1 ,··· ,fK

e

Here each of the K environments consists of molecules with the same scaffold. Since the number of
environments is large, we impose parameter sharing among the competing predictors f1 , · · · , fK .
Specifically, the input of fj = f 0 (φ(x), j) is a concatenation of φ(x) and one-hot encoding of j.
Model hyperparameters For our model, we set λh = λe = 0.1 and perturbation learning rate
α = 0.1, which worked well across all experiments. All methods are trained with Adam using its
default configuration. Our GCN implementation is based on chemprop [10].
• For unsupervised transfer, we use their default hyper-parameter setting. For all methods, the GCN
φ has three layers with hidden layer dimension 300. The predictor f is a two-layer MLP.
• For supervised transfer, we perform hyper-parameter optimization to identify the best architecture
for the multitask GCN. The GCN φ has two layers with hidden layer dimension 2000. The predictor
f is a three-layer MLP. The dropout rate is 0.1. For fair comparison, all the methods use the same
architecture in this setting.
4.1

Unsupervised transfer

Setup Our model is a single-task binary classification model which predicts the SARS-CoV-1
3CLpro inhibition. After training, the model is tested on SARS-CoV-2 Mpro and antiviral data. Each
model is evaluated under five independent runs and we report the average AUROC score.
Results Our results are shown in Table 1. The proposed method significantly outperformed all the
baselines, especially on the Mpro inhibition prediction dataset (0.756 versus 0.653 AUROC).
Ablation study Indeed, the improvement of our model comes from two sources: the additional
auxiliary task and IRM principle. To show individual contribution of each component, we conduct an
ablation study of our method without the IRM principle. The loss function in this case is the scaffold
classification loss plus property prediction loss λe Le (g ◦ φ) + L(f ◦ φ). The performance of this
method is shown in the end of Table 1 (“without IRM”). The auxiliary scaffold classifier shows quite
significant improvement, but is still inferior to our full model trained with IRM principle.
4.2

Drug repurposing for SARS-CoV-2

Setup We extend all the methods to multitask binary classification models that predict three different
properties for each new compound: 1) probability of inhibiting the SARS-CoV-2 Mpro; 2) antiviral
activity against SARS-CoV-2; 3) probability of inhibiting SARS-CoV-1 3CLpro.
6

Table 1: Unsupervised transfer results. Models are trained on SARS-CoV-1 data and tested on
SARS-CoV-2 compounds. We report average of AUROC under 5-fold cross validation.

Direct Transfer
DANN [5]
SANN
CDAN [7]
IRM [1]
Our method
- without IRM

Mpro inhibition AUC
0.642 ± 0.021
0.646 ± 0.012
0.630 ± 0.079
0.625 ± 0.013
0.653 ± 0.022
0.756 ± 0.012
0.736 ± 0.007

Antiviral activity AUC
0.415 ± 0.081
0.607 ± 0.121
0.570 ± 0.096
0.639 ± 0.067
0.391 ± 0.086
0.695 ± 0.068
0.678 ± 0.057

Table 2: 5-fold cross validation of different methods. CoV-2 means that the model is trained on
SARS-CoV-2 data. CoV-1 means that the model is additionally trained on SARS-CoV-1 data.
Method
Multitask GCN
Multitask GCN
DANN
IRM [1]
Our method

CoV-1
X
X
X
X

CoV-2
X
X
X
X
X

Mpro inhibition AUC
0.7646 ± 0.0398
0.7841 ± 0.0416
0.7785 ± 0.0321
0.7778 ± 0.0426
0.7955 ± 0.0489

Antiviral activity AUC
0.7404 ± 0.1117
0.8067 ± 0.0690
0.8146 ± 0.1068
0.8198 ± 0.1072
0.8930 ± 0.0267

Each model is evaluated under 5-fold cross validation with the same splits. In each fold, the training
set contains the SARS-CoV data and 60% of the SARS-CoV-2 data (Mpro + antiviral), and the test
set contains the rest 40% of the SARS-CoV-2 compounds. We report the mean and standard deviation
of AUROC score evaluated on five different folds.
Results Our results are shown in Table 2. The proposed method significantly outperformed the two
baselines, especially on the antiviral activity prediction dataset (0.89 versus 0.82 AUROC). As an
ablation study, we also trained a GCN on only SARS-CoV-2 data (the first row in Table 2). Indeed,
the multitask GCN trained with additional SARS-CoV-1 data performs better (0.740 vs 0.807 on
antiviral prediction), indicating that the two virus are closely related.
The best model is then used to predict the SARS-CoV-2 Mpro inhibition and antiviral activity of
compounds in Broad drug repurposing hub. In order to utilize maximal amount of labeled data, the
model is re-trained under 10-fold cross validation with 90%/10% split (instead of 60%/40%). The
resulting 10 models are combined together as an ensemble to predict properties for new compounds.
We report the top 20 predicted molecules for MPro inhibition and antiviral activity in Table 3 and 4.

5

Conclusion

In this paper, we investigate existing domain extrapolation paradigms and their limitations. To allow
the method to extrapolate across combinatorially many environments, we propose a new method
which complements invariant risk minimization with adaptive environments. The method is evaluated
on molecule property prediction tasks and shows significant improvements over strong baselines.

References
[1] Martin Arjovsky, Léon Bottou, Ishaan Gulrajani, and David Lopez-Paz. Invariant risk minimization. arXiv preprint arXiv:1907.02893, 2019.
[2] Guy W Bemis and Mark A Murcko. The properties of known drugs. 1. molecular frameworks.
Journal of medicinal chemistry, 39(15):2887–2893, 1996.
[3] Shiyu Chang, Yang Zhang, Mo Yu, and Tommi S Jaakkola. Invariant rationalization. arXiv
preprint arXiv:2003.09772, 2020.
7

Table 3: Top 20 SARS-CoV-2 Mpro inhibiting molecules (non-covalent) in the Broad drug repurposing hub.
SMILES
Nc1ccc(cc1)S(N)(=O)=O
N#Cc1ccncn1
Nc1ccccc1S(N)(=O)=O
Cc1ccc(cc1)S(N)(=O)=O
NS(=O)(=O)c1cc(Cl)c(Cl)c(c1)S(N)(=O)=O
NCc1ccc(cc1)S(N)(=O)=O
NC(=N)NCCNS(=O)(=O)c1cccc2cnccc12
NC(=N)NS(=O)(=O)c1ccc(N)cc1
NS(=O)(=O)NCc1csc2ccccc12
NS(=O)(=O)C#Cc1ccccc1
Nc1cc(C(Cl)=C(Cl)Cl)c(cc1S(N)(=O)=O)S(N)(=O)=O
NC(=N)NCC1COC2(CCCCC2)O1
NC(=N)NC(=O)c1cnccn1
NC(=N)Nc1ccc(cc1)C(=O)Oc1ccc2cc(ccc2c1)C(N)=N
N#Cc1ncccn1
Nc1ccncc1N
N#Cc1ccc(cc1)C1CCCc2cncn12
NS(=O)(=O)Cc1noc2ccccc12
NS(=O)(=O)c1ccc(NC(=O)Nc2ccc(F)cc2)cc1

MPro
0.797
0.769
0.747
0.727
0.695
0.694
0.679
0.662
0.651
0.614
0.613
0.582
0.580
0.560
0.524
0.521
0.450
0.443
0.442

Table 4: Top 20 SARS-CoV-2 antiviral molecules in the Broad drug repurposing hub.
SMILES
C[C@]12CC(=O)[C@H]3[C@@H](CCC4=CC(=O)CC[C@]34C)[C@@H]1CC[C@]2(O)C(=O)CO
C[C@]1(O)CC[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3CC[C@]12C
C[C@]12C[C@H](O)[C@H]3[C@@H](CCC4=CC(=O)CC[C@]34C)[C@@H]1CC[C@]2(O)C(=O)CO
CC(=O)OCC(=O)[C@@]1(O)CC[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3C(=O)C[C@]12C
C[C@H]1C[C@H]2[C@@H]3CC[C@](O)(C(C)=O)[C@@]3(C)CC[C@@H]2[C@@]2(C)CCC(=O)C=C12
CC(=O)[C@H]1CC[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3CC[C@]12C
C[C@@]12[C@H](CC[C@]1(O)[C@@H]1CC[C@@H]3C[C@@H](O)CC[C@]3(C)[C@H]1C[C@H]2O)C1=CC(=O)OC1
C[C@]12CC[C@H]3[C@@H](CCC4=CC(=O)CC[C@]34C)[C@@H]1CC[C@@H]2C(=O)CO
CC(C)(C)C(=O)OCC(=O)[C@H]1CC[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3CC[C@]12C
C[C@]12CC(=O)C3C(CCC4=CC(=O)CC[C@]34C)C1CC[C@]2(O)C(=O)CO
CC(=O)O[C@@]1(CC[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3CC[C@]12C)C(C)=O
CC(=O)OCC(=O)[C@H]1CC[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3CC[C@]12C
C\C=C1/C(=O)C[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3CC[C@]12C
C[C@]12CC[C@H]3[C@@H](CC[C@@H]4C[C@@H](O)CC[C@]34C)[C@@]1(O)CC[C@@H]2C1=CC(=O)OC1
CCCC(=O)O[C@@]1(CC[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3[C@@H](O)C[C@]12C)C(=O)CO
CCC(=O)O[C@@]1(CC[C@H]2[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3CC[C@]12C)C(=O)CO
CC(=O)[C@@]12OC(C)(O[C@@H]1C[C@H]1[C@@H]3CCC4=CC(=O)CC[C@]4(C)[C@H]3CC[C@]21C)c1ccccc1
CC(=O)OCC(=O)[C@@]1(O)CCC2C3CCC4=CC(=O)CC[C@]4(C)C3[C@@H](O)C[C@]12C
CC(=O)[C@@]1(O)CCC2C3CCC4=CC(=O)CC[C@]4(C)C3CC[C@]12C
C[C@]12CCC3C(CCC4=CC(=O)CC[C@]34C)C1CC[C@@H]2O

Antiviral
0.955
0.953
0.948
0.945
0.945
0.944
0.936
0.932
0.931
0.924
0.924
0.920
0.919
0.918
0.902
0.894
0.880
0.877
0.876
0.872

[4] Steven M Corsello, Joshua A Bittker, Zihan Liu, Joshua Gould, Patrick McCarren, Jodi E
Hirschman, Stephen E Johnston, Anita Vrcic, Bang Wong, Mariya Khan, et al. The drug
repurposing hub: a next-generation drug library and information resource. Nature medicine, 23
(4):405–408, 2017.
[5] Yaroslav Ganin, Evgeniya Ustinova, Hana Ajakan, Pascal Germain, Hugo Larochelle, François
Laviolette, Mario Marchand, and Victor Lempitsky. Domain-adversarial training of neural
networks. The Journal of Machine Learning Research, 17(1):2096–2030, 2016.
8

[6] Sangeun Jeon, Meehyun Ko, Jihye Lee, Inhee Choi, Soo Young Byun, Soonju Park, David
Shum, and Seungtaek Kim. Identification of antiviral drug candidates against sars-cov-2 from
fda-approved drugs. bioRxiv, 2020.
[7] Mingsheng Long, Zhangjie Cao, Jianmin Wang, and Michael I Jordan. Conditional adversarial
domain adaptation. In Advances in Neural Information Processing Systems, pages 1640–1650,
2018.
[8] Aaron van den Oord, Yazhe Li, and Oriol Vinyals. Representation learning with contrastive
predictive coding. arXiv preprint arXiv:1807.03748, 2018.
[9] Diamond Light Source.
Sars-cov-2 main protease structure and xchem fragment screen.
2020.
www.diamond.ac.uk/covid-19/for-scientists/
Main-protease-structure-and-XChem.
[10] Kevin Yang, Kyle Swanson, Wengong Jin, Connor Coley, Philipp Eiden, Hua Gao, Angel
Guzman-Perez, Timothy Hopper, Brian Kelley, Miriam Mathea, et al. Analyzing learned molecular representations for property prediction. Journal of chemical information and modeling, 59
(8):3370–3388, 2019.
[11] Han Zhao, Remi Tachet des Combes, Kun Zhang, and Geoffrey J Gordon. On learning invariant
representation for domain adaptation. arXiv preprint arXiv:1901.09453, 2019.
[12] Peng Zhou, Xing-Lou Yang, Xian-Guang Wang, Ben Hu, Lei Zhang, Wei Zhang, Hao-Rui
Si, Yan Zhu, Bei Li, Chao-Lin Huang, et al. A pneumonia outbreak associated with a new
coronavirus of probable bat origin. Nature, 579(7798):270–273, 2020.

9

